\documentclass[a4paper,12pt,oneside]{report}
\usepackage[utf8]{inputenc}
\usepackage[polish]{babel}
\usepackage[T1]{fontenc}
\usepackage{url}
\usepackage{graphicx}
\usepackage{listings}
\usepackage[a4paper,tmargin=2.5cm,rmargin=2.5cm,bmargin=2.5cm,lmargin=3.5cm,pdftex]{geometry}
\usepackage{setspace}
\usepackage{latexsym}
\usepackage{lscape}
\usepackage{tocbibind}
% Dane o pracy
\author{Igor~Rzegocki}
\title{Migracja serwisu WWW z techniki PHP na Ruby~on~Rails}
\date{2008}
\pagestyle{headings}
\onehalfspacing

\begin{document}
%\maketitle
\pagenumbering{alph}
\begin{titlepage}
  \begin{center}
%  \textsc{\Huge Akademia Górniczo--Hutnicza}\\
%  \textsc{\Large im. Stanisława Staszica w Krakowie}\\[0.5cm]
  \includegraphics[keepaspectratio]{agh-logo.jpg}\\[0.5cm]
  \textsc{\large Wydział Elektrotechniki, Automatyki, Informatyki i Elektroniki}\\[0.5cm]
  \textsc{\large Katedra Telekomunikacji}\\[1.5cm]
  \textbf{\huge Praca dyplomowa}\\[1cm]
  \textbf{\large magisterska}\\[2.5cm]
  \begin{tabbing}
    \hspace{0.45\textwidth}\=\kill
    \large Imię i nazwisko \> \large \bfseries Igor Rzegocki\\[0.25cm]
    \large Kierunek studiów \> \large Elektronika i Telekomunikacja\\[0.25cm]
    \large Temat pracy dyplomowej \> \parbox{0.55\textwidth}{\large \bfseries ,,Migracja serwisu WWW z techniki PHP na Ruby~on~Rails''}\\[2cm]
    \large Opiekun pracy \> \large dr inż. Krzysztof Juszkiewicz\\[2cm]
  \end{tabbing}
  \vfill
  {\large Kraków, rok 2008}
  \end{center}
\end{titlepage}
% Dedykacja
\thispagestyle{empty}
\begin{flushright}
\vspace*{13cm}
\emph{Pracę swą dedykuję Grzegorzowi, którego nagła i niespodziewana śmierć pozostawiła ogromną pustkę w sercach jego przyjaciół}
\end{flushright}
\clearpage\pagenumbering{roman}

\tableofcontents
\clearpage\pagenumbering{arabic}
\chapter{Wstęp}
\label{cha:wstep}

TODO

\chapter[Techniki po stronie serwera]{Techniki serwerowe wykorzystywane w aplikacjach internetowych}
\label{cha:serwer}

Ponieważ rynek aplikacji webowych jest dzisiaj duży, wielu producentów oprogramowania chce na nim zaistnieć. Dlatego prawie każdy język proponuje rozwiązania wspomagające budowę aplikacji internetowych. Najpopularniejszymi technikami są C\#.NET, Java, Python, Ruby oraz PHP. Jeszcze 10 lat temu dużą uwagę zwracano na wydajność. Sprzęt komputerowy był stosunkowo drogi, więc sięgano do języków niskopoziomowych, które mogły zapewnić szybkie działanie przy małym zużyciu zasobów. Jednak dzisiaj sytuacja diametralnie się zmieniła. Oczywiście wydajność jest nadal ważna, ale zmiana serwera na szybszy lub dokupienie kolejnego aby przyspieszyć działanie aplikacji, nie jest już tak relatywnie drogie. Na pierwszy plan wychodzą rozwiązania, które są wygodne dla programistów i pozwalają w krótkim czasie dodać nową funkcjonalność aplikacji lub zmodyfikować istniejącą. Obecnie niewielu programistów używa tylko standardowych bibliotek do budowy aplikacji. Każdy język oferuje dodatkowe biblioteki lub całe rozwiązania, które ułatwiają tworzenie i rozwój systemu. 

Poniżej zostały scharakteryzowane wyżej wymienione języki, oraz dostępne dla nich rozwiązania.

\section{Interfejs CGI}
\label{sec:cgi}
Na początku wszystkie strony internetowe były statyczne. To znaczy ich autorzy tworzyli osobny plik z kodem HTML dla każdej strony. Zmiana czegokolwiek wymagała każdorazowej edycji kodu. Oczywiście takich stron nie można nazwać aplikacją, bardziej pasujące byłoby tu określenie publikacja.

Przełomem w tworzeniu stron i początkiem aplikacji internetowych było stworzenie w 1993 specyfikacji interfejsu CGI.

,,CGI (ang. Common Gateway Interface) to znormalizowany interfejs, umożliwiający komunikację pomiędzy oprogramowaniem serwera WWW a innymi programami znajdującymi się na serwerze. Zazwyczaj program serwera WWW wysyła do przeglądarki statyczne dokumenty HTML. Za pomocą programów CGI można dynamicznie (na żądanie klienta) generować dokumenty HTML uzupełniając je np. treścią pobieraną z bazy danych.''\footnote{Źródło: \url{http://pl.wikipedia.org/wiki/CGI}}

Interfejs CGI jest ogniwem, które łączy serwer WWW ze skryptem CGI. Zasada działania jest bardzo prosta. Serwer WWW dostarcza dane do programu poprzez standardowe wejście, lub pod postacią zmiennych środowiskowych. Program dostarcza swój wynik na standardowe wyjście, który następnie jest wysyłany przez serwer do przeglądarki. 

Dzięki temu, że po drugiej stronie interfejsu można umieścić program, twórca serwisu jest w stanie dynamicznie generować dokumenty przed wysłaniem ich do klienta. Jako źródło danych może posłużyć baza danych. Następnie te dane można sformatować aby były prezentowane w sposób czytelny w oknie przeglądarki. Program może otrzymać dane z formularza jako parametry, można w ten sposób generować, przetwarzać i zapisywać dane z ankiet i kwestionariuszy. Można też dynamicznie generować obrazy takie jak wykresy czy schematy.

Co najważniejsze implementacja programu CGI nie jest zależna od żadnej platformy. Każdy serwer WWW może zaimplementować (i przeważnie implementuje) mechanizm CGI. Programy CGI można pisać w dowolnym języku programowania, wiele języków posiada biblioteki ułatwiające obsługę interfejsu. Standard CGI\footnote{Zobacz \url{http://www.w3.org/CGI/} i \url{http://hoohoo.ncsa.uiuc.edu/cgi/}} jest dostępny za darmo i nie zmienił się od 1995 roku. 

Początkowo językami najczęściej wykorzystywanymi do współpracy z CGI były Perl oraz C. Taki wybór był w pełni uzasadniony. C był i jest bardzo popularnym językiem programowania, a jego największą zaletą jest niewątpliwie wydajność. Natomiast Perl jest językiem stworzonym do przetwarzania danych tekstowych, więc znakomicie nadaje się do generowania kodu HTML.

Mechanizm interfejsu CGI jest wykorzystywany do dzisiaj, jednak nie jest to najszybsza metoda komunikacji pomiędzy serwerem WWW, a aplikacją obsługującą żądania HTTP. Programy CGI zostały zastąpione przez rozszerzenia dla serwerów dedykowane dla danego języka programowania, lub nawet całe serwery dedykowane.

\section{Java}
\label{sec:java}
Java jest darmową techniką rozwijaną pod kierunkiem firmy Sun Microsystems. Kod języka jest kompilowany do tzw.~bajtkodu, który następnie jest wykonywany przez maszynę wirtualną. Głównymi cechami języka są: pełna obiektowość, niezależność od architektury (raz stworzony bajtkod może być wykonywany na wirtualnej maszynie uruchomionej w dowolnym systemie operacyjnym), sieciowość i obsługa programowania rozproszonego, niezawodność i bezpieczeństwo.

Wczesne wersje języka były krytykowane za powolne działanie, jednak dzisiejsze wersje są o wiele szybsze i bardzo stabilne. Do budowy aplikacji webowych Sun proponuje serwlety wykonywane po stronie serwera a także aplety które mogą być osadzane na stronie WWW i wykonywane przez przeglądarkę na komputerze użytkownika. Jedną z alternatyw jest bezpłatny zestaw narzędzi Struts\footnote{Zobacz \url{http://struts.apache.org/}}, wspomagany przez bibliotekę Hibernate\footnote{Zobacz \url{http://www.hibernate.org/}} ułatwiającą obsługę bazy danych. Popularny jest także projekt Spring\footnote{Zobacz \url{http://www.springframework.org/}}. Technika Java posiada także swój serwer WWW -- Tomcat\footnote{Zobacz \url{http://tomcat.apache.org/}}. Budowę aplikacji ułatwiają bardzo dobre zintegrowane środowiska programistyczne Eclipse lub NetBeans dedykowane dla tego języka.

Dużą zaletą języka jest to, że technika ta ma bardzo dużo zastosowań. Można w niej tworzyć takie rozwiązania, jak aplikacje okienkowe czy nawet aplikacje dedykowane dla telefonów komórkowych. Posiada bardzo rozbudowane biblioteki obsługi sieci i oprogramowania rozproszonego. Sprawdza się wszędzie tam, gdzie jest jeden duży system, składający się z mniejszych aplikacji, który ma za zadanie pełnić wiele ról przy jednoczesnej integracji. Taki przykładem może być system ERP (ang. Enterprise Resource Planning, planowanie zasobów przedsiębiorstwa) IFS\footnote{Zobacz \url{http://www.ifsworld.com/pl/}}, który jest w całości napisany w języku Java.
\begin{itemize}
\item Zalety języka:
  \begin{itemize}
  \item stabilność i wydajność,
  \item cena (za darmo lub otwarty kod),
  \item międzyplatformowość,
  \item mnogość możliwych rozwiązań.
  \end{itemize}
\item Wady:
  \begin{itemize}
  \item mnogość możliwych rozwiązań (czasami jest ich taka ilość, że ciężko jest wybrać coś dobrego),
  \item potrzeba przekompilowania kodu po każdej zmianie,
  \item rozwój aplikacji w języku Java jest stosunkowo pracochłonny.
  \end{itemize}
\end{itemize}

\section{C\#.NET}
\label{sec:dotnet}
Język C\# jest odpowiedzią firmy Microsoft na technikę Java. Podobnie jak ona jest obiektowym językiem wysokopoziomowym. Kompiluje się do języka Common Intermediate Language (CIL) (podobnie jak bajtkod Javy), który następnie wykonywany jest w odpowiednim środowisku uruchomieniowym. Do budowy aplikacji webowych wykorzystuje się platformę .NET\footnote{Zobacz \url{http://www.microsoft.com/net/}}. Może ona współpracować również z innymi językami programowania takimi jak: Visual Basic, J\#, Jscript.Net, COBOL, Fortran, Lisp, Pyton, Perl i kilka innych. Środowisko .NET ma o wiele większe możliwości niż tylko aplikacje webowe. Z powodzeniem może posłużyć do budowania aplikacji okienkowych dla systemu Windows. Dedykowany serwer WWW dla aplikacji .NET to IIS\footnote{Zobacz \url{http://www.iis.net/}}, oczywiście firmy Microsoft. Firma Microsoft dostarcza także środowisko programistyczne Visual Studio.

Platforma .NET z językiem C\#  ma także szersze spektrum zastosowań. Do bardziej znanych rozwiązań należy system obsługi banku PKO~BP~S.A. czy Getin~BANK~S.A zbudowane przez krakowską firmę Vsoft\footnote{Zobacz \url{http://www.vsoft.pl/}}. Obydwa systemy obsługują większą cześć procesów w banku i posiadają także moduł bankowości internetowej. Dobrym przykładem zastosowań webowych jest serwis społecznościowy MySpace\footnote{Zobacz \url{http://www.myspace.com/}}, który posiada ponad 100 milionów użytkowników na całym świecie.
\begin{itemize}
\item Zalety:
  \begin{itemize}
  \item pełne wsparcie techniczne ze strony Microsoftu,
  \item sprawdzona i stabilna technika.
  \end{itemize}
\item Wady:
  \begin{itemize}
  \item cena,
  \item całkowita zależność od platformy Microsoft.
  \end{itemize}
\end{itemize}

\section{PHP}
\label{sec:php}
Język PHP\footnote{Zobacz \url{http://www.php.net/}} (ang. PHP: Hypertext Preprocessor) był od początku projektowany do wykorzystania dla potrzeb aplikacji webowych. Pierwotnie był raczej zestawem narzędzi niż językiem, dopiero od wersji 3, można mówić o języku programowania. Jest on językiem interpretowanym, to znaczy przy każdym uruchomieniu interpreter czyta kod źródłowy i wykonuje go. Dzięki temu każda zmiana w aplikacji ma natychmiastowy efekt. Chociaż udostępnia on możliwość programowania obiektowego, tak naprawdę jest językiem proceduralnym. Jego popularność jest bardzo duża ze względu na łatwość jego użycia. Jest całkowicie darmowy (otwarty kod), a jego interpreter jest dostępny na wiele platform. Istnieje tu wiele platform (np. Zend Framework, Zoop Framework, Symfony, Prado, CakePHP), wiele bibliotek do obsługi baz danych (np. ADOdb, Propel, PEAR::DB). Jednak wydaje się, że język PHP nie ma przed sobą przyszłości. Lista zarzutów jest poważna:
\begin{itemize}
  \item jest wiele nieścisłości w nazwach funkcji i kolejności argumentów,
  \item część standardowych bibliotek jest udostępniana proceduralnie, a część obiektowo,
  \item kompatybilność wsteczna nie pozwala na uporządkowanie języka,
  \item brak możliwości obsługi niektórych błędów powoduje zatrzymanie wykonywania aplikacji.
\end{itemize}
Skrypty PHP są obsługiwane najczęściej za pomocą serwera Apache2.

Język nadaje się zarówno do budowy dużych aplikacji (np. \url{http://www.yahoo.com/}, \url{http://www.interia.pl/}, \url{http://facebook.com}), jak i do budowy małych komponentów (np. licznik odwiedzin, księga gości). Jest on bardzo często pierwszym językiem od którego programiści zaczynają przygodę z aplikacjami webowymi.
\begin{itemize}
\item Zalety:
  \begin{itemize}
  \item łatwość użycia, 
  \item popularność,
  \item dostępność,
  \item cena (open source).
  \end{itemize}
\item Wady:
  \begin{itemize}
  \item język proceduralny,
  \item brak perspektyw rozwoju,
  \item niespójne API (ang. Application Programming Interface)
  \end{itemize}
\end{itemize}

\section{Python}
\label{sec:python}
Python\footnote{Zobacz \url{http://python.org/}} to interpretowany język programowania stworzony jako następca języka ABC\footnote{Zobacz \url{http://idhub.com/abc/}}. Jest to język zaprojektowany z myślą o jak największej produktywności, prostocie i czytelności kodu. Obsługuje też typy dynamiczne oraz automatyczne zarządzanie pamięcią. Ciekawą cechą Pythona jest to, że mimo iż różne części języka są opisane i ustandaryzowane, to język sam w sobie wciąż nie ma specyfikacji. 

Python jest językiem, który wspiera różne paradygmaty programowania:
\begin{itemize}
  \item programowania strukturalnego,
  \item programowania funkcjonalnego,
  \item programowania obiektowego.
\end{itemize}

Kolejną jego cechą jest rozszerzalność. Zamiast wbudowywać wszystko w rdzeń języka, można łatwo dokładać napisane w C lub C++ moduły. Dzięki temu sam rdzeń pozostaje mały, elastyczny i wydajny. Takie rozwiązanie wzięło się z frustracji autora językiem ABC, w którym założenia były dokładnie odwrotne \footnote{Zobacz \url{http://www.artima.com/intv/pythonP.html}}.

Python bywa często wykorzystywany w aplikacjach internetowych. Najbardziej znana to \url{http://www.youtube.com/}, a z polskich \url{http://www.grono.net/}. Doczekał się również wielu platform programistycznych -- najpopularniejsze to: Django\footnote{Zobacz \url{http://www.djangoproject.com/}}, Zope\footnote{Zobacz \url{http://www.zope.org/}}, TurboGears\footnote{Zobacz \url{http://www.turbogears.org/}} i Pylons\footnote{Zobacz \url{http://www.pylonshq.com/}}.

\begin{itemize}
  \item Zalety:
  \begin{itemize}
    \item elastyczność i rozszerzalność,
    \item wydajność,
    \item wiele środowisk programistycznych.
  \end{itemize}
  \item Wady:
  \begin{itemize}
    \item duża swoboda programowania powoduje bałagan w kodzie,
    \item wymóg stosowania wcięć znacznie utrudnia stworzenie dobrego systemu szablonów.
  \end{itemize}
\end{itemize}

\section{Ruby}
\label{sec:ror}
Ruby (dosł. rubin) to interpretowany, w pełni obiektowy język programowania stworzony w 1995 roku przez Yukihiro Matsumoto. Jak twierdzi jego autor\footnote{Porównaj http://www.informit.com/articles/article.aspx?p=18225\&rl=1}, Ruby został zaprojektowany dla optymalizacji wydajności programistów, przy zachowaniu zasady dobrego interfejsu. Ze względu na pochodzenie języka (Japonia), początkowo był on mało popularny z powodu braku angielskiej dokumentacji. Jednak dzięki Internetowi rosła jego popularność i z czasem zaczęły się pojawiać artykuły w języku angielskim a wraz z nimi społeczność skupiona wokół tego języka. Przełomem była prezentacja w 2003 roku platformy Ruby On Rails (dosł. rubin na szynach). Posiada ona wszystko, co jest niezbędne do budowy aplikacji webowych i znakomicie nadaje się do bardzo szybkiej budowy małych aplikacji, a także do budowania prototypów aplikacji. Interpretery języka istnieją na każdą platformę. Jedyną wadą zdaje się być jego niska wydajność (podobnie jak we wczesnych wersjach języka Java), którą jednak można zwiększyć wykorzystując JRuby (implementację interpretera w języku Java). Ruby posiada swoje dwa serwery WWW -- Mongrel oraz Webrick. Można używać także serwera Apache za pośrednictwem interfejsu CGI lub rozszerzenia \emph{mod\_ruby}.

\begin{itemize}
\item Zalety:
  \begin{itemize}
  \item darmowy,
  \item pełna obiektowość,
  \item duże perspektywy rozwoju, 
  \item przejrzystość kodu, 
  \item bardzo prosty w nauce,
  \item duża aktywna społeczność zawsze chętna do pomocy.
  \end{itemize}
\item Wady:
  \begin{itemize}
  \item niska wydajność,
  \item brak znanych udanych wdrożeń.
  \end{itemize}
\end{itemize}

\section{Ruby on Rails}
\label{sec:ror}

Współdziałanie środowiska Rails i języka Ruby ma umożliwiać programiście szybkie, wydajne i łatwe tworzenie aplikacji internetowych. Efekt taki uzyskano łącząc cechy dynamicznego i obiektowego języka ze sprawdzonymi wzorcami i schematami dotyczącymi projektowania aplikacji internetowych.

,,Często ludzie, zwłaszcza inżynierowie oprogramowania skupiają się na maszynach. Sądzą oni iż robiąc to tak sprawimy, iż maszyna będzie pracowała szybciej. Jeśli znów zmienimy coś innego to znów maszyna przyśpieszy. Skupiają się tylko na procesorach i wydajności. Tak naprawdę potrzebujemy skupić się na programistach. Na tym jak ludzie chcą aby ich aplikacje były zaprojektowane i jak działały. To my jesteśmy władcami. One są niewolnikami.”\footnote{Yukihiro Matsumoto, The Philosophy of Ruby, 2003}. Słowa te najlepiej obrazują filozofię języka, jak i to co można uzyskać używając połączonych sił Ruby i Rails. 

Cechy Ruby~on~Rails to przede wszystkim:
\begin{itemize}
  \item Szybkość, łatwość i przyjemność z pisania,
  \item Reguła DRY -- Don't Repeat Yourself (zob. rozdz.~\ref{sec:dry}, str.~\pageref{sec:dry}),
  \item Reguła Convention over Configuration (zob. rozdz.~\ref{sec:coc}, str.~\pageref{sec:coc}),
  \item Architektura MVC (Model-view-controller) jako sprawdzony wzorzec budowania aplikacji internetowych (zob. rozdz.~\ref{sec:mvc}, str.~\pageref{sec:mvc}),
  \item Testy, jako integralna część aplikacji, do pomocy i automatyzacji procesu wyszukiwania błędów,
  \item Prostota w dodawaniu wtyczek (rozszerzają aplikację o całą gamę gotowych funkcjonalności od prostego logowania do całych modułów zarządzających).
\end{itemize}

Platforma Rails zbudowany jest z trzech zasadniczych elementów:

\begin{itemize}
\item \emph{Active Record} -- mechanizm ORM (Object-relational Mapping) (zob. rozdz.~\ref{sec:orm}, str.~\pageref{sec:orm}) odpowiada za odwzorowanie obiektowej architektury obiektów na relacyjną strukturę bazy danych. Różni się on od zwyczajnych systemów ORM minimalizacją potrzebnych konfiguracji ze strony programisty. Odpowiada za generowanie modeli.
\item \emph{Action Pack} -- zestaw klas, w którego skład wchodzą klasy obsługujące widoki oraz kontrolery. Dzięki uniwersalnemu podejściu widoki nie muszą tylko i wyłącznie ograniczać się do produkowania kodu HTML, który potem wyświetlany jest w przeglądarce. W bardzo prosty sposób możemy przekształcać nasze widoki do XML’a , generować dynamiczny JavaScript , używać protokołu SOAP oraz wiele innych. Kontrolery natomiast są logiką całej naszej aplikacji. Zarządzają interakcjami między użytkownikami a systemem, modelami a widokami itd.
\item Mechanizm ,,scaffolding'' -- służy bardzo szybkiemu tworzeniu gotowych powiązań między modelem a kontrolerem i widokami. W praktyce jest to po prostu generator gotowego kodu źródłowego dla danego modelu. Tworzone są wszystkie podstawowe akcje jak stwórz, czytaj, edytuj, kasuj (zob. rozdz.~\ref{sec:crud}, str.~\pageref{sec:crud}). Zwalnia to programistę z pisania po raz kolejny tych samych wspólnych zachowań dla modelu i pozwala skupić się na tym jak aplikacja ma działać, a nie na wymyślaniu kolejnego systemu walidacji danych.
\end{itemize}

Kolejnym ważnym elementem przemawiającym na korzyść platformy, jest ilość dostępnych darmowych wtyczek, które automatyzują/ułatwiają wykonywanie określonych zadań. Główny serwis \url{http://rubyforge.org}, który zajmuje się zbieraniem i informowaniem o wtyczkach, posiada obecnie 5912\footnote{Stan na 24 maja 2008 r.} różnych wtyczek, które możemy użyć w naszym projekcie.

Dzięki uniwersalności i prostocie możemy stosować środowisko Ruby~on~Rails wszędzie tam, gdzie potrzebujemy szybko, przyjemnie i bezproblemowo stworzyć aplikację internetową. W bardzo krótkim czasie możemy przygotować gotowe elementy naszego systemu. Każdy kawałek kodu ma swoje jedno dokładnie pasujące miejsce. Tworząc tylko podstawowy szkielet aplikacji mamy już bardzo dużo rzeczy zrobionych za nas, czekających tylko do wykorzystania.

Największą aplikacją napisaną całkowicie w technice Ruby~on~Rails jest Basecamp\footnote{Zobacz http://www.basecamphq.com/}. Basecamp jest aplikacją wspomagającą zarządzanie projektami, która obecnie obsługuje ponad milion użytkowników. Drugą duża aplikacją jest Twitter\footnote{Zobacz http://www.twitter.com/}. Twitter jest z kolei platformą służącą do ,,mikroblogowania'' (czyli pisania wpisów nie dłuższych niż 140 znaków). Obecnie cała społeczność Ruby~on~Rails śledzi losy Twittera, gdyż ma on ogromne problemy wydajnościowe. Od tego jak je rozwiąże, zależy jak inwestorzy komercyjni ocenią przydatność samego środowiska.

\chapter{Techniki po stronie klienta}
\label{cha:klient}

\section{HTTP}
\label{sec:http}
,,HTTP (HyperText Transfer Protocol - protokół przesyłania dokumentów hypertekstowych) to protokół sieci WWW. Obecną definicję HTTP stanowi RFC~2616. Za pomocą protokołu HTTP przesyła się żądania udostępnienia dokumentów WWW, informacje o kliknięciu odnośnika oraz informacje z formularzy. Zadaniem stron WWW jest publikowanie informacji -- natomiast protokół HTTP właśnie to umożliwia.''\footnote{Źródło: \url{http://pl.wikipedia.org/wiki/HTTP}}

HTTP jest to protokół zapytań i odpowiedzi pomiędzy klientem a serwerem. Jest on bardzo użyteczny, ponieważ udostępnia znormalizowany sposób komunikowania się komputerów ze sobą. Określa on formę żądań klienta dotyczących danych oraz formę odpowiedzi serwera na te żądania. Jest to protokół bezstanowy ponieważ nie zachowuje żadnych informacji o poprzednich transakcjach z klientem. Protokół definiuje osiem metod, które mogą być użyte w żądaniu HTTP:
\begin{itemize}
  \item \emph{GET} -- pobranie informacji wskazanej przez identyfikator URL (ang. Uniform Resource Locator, jednoznaczny wskaźnik zasobu),
  \item \emph{HEAD} -- pobiera informacje o tym czy dana informacja istnieje,
  \item \emph{PUT} -- informacja potwierdzająca pobranie danych w postaci pliku od klienta przez serwer,
  \item \emph{POST} -- analogicznie jak powyżej tyle, że informacja nie musi być plikiem (np. formularze),
  \item \emph{DELETE} -- żądanie usunięcia informacji -- wymagane odpowiednie uprawnienia,
  \item \emph{OPTIONS} -- informacje o opcjach i wymaganiach istniejących w kanale komunikacyjnym, 
  \item \emph{TRACE} -- analiza i diagnostyka kanału komunikacyjnego, 
  \item \emph{CONNECT} -- żądanie wykorzystywane w tunelujących serwerach proxy.
\end{itemize}

Dla potrzeb przeglądania stron WWW używane są metody GET oraz POST. Natomiast cały zestaw metod protokołu HTTP daje znacznie większe możliwości i może posłużyć do kompleksowej wymiany informacji pomiędzy komputerami w sieci Internet.

\section{HTML}
\label{sec:html}
Zawartość strony internetowej jest hipertekstem, znaczy to, że użytkownik oglądając stronę internetową może podążać za hiperłączami, które przenoszą go do innych stron internetowych w ramach tego samego serwera internetowego lub innych dostępnych w ramach sieci. Znaczy to też obecność grafiki i innych multimediów.

,,Hipertekst to organizacja danych w postaci niezależnych leksji połączonych hiperłączami. Hipertekst cechuje nielinearność i niestrukturalność układu leksji. Oznacza to, że nie ma z góry zdefiniowanej kolejności czytania leksji, a nawigacja między nimi zależy wyłącznie od użytkownika.''\footnote{Źródło \url{http://pl.wikipedia.org/wiki/Hipertekst}}

Implementacją hipertekstu na potrzeby WWW jest język HTML.

,,HTML (HyperText Markup Language, hipertekstowy język znaczników), to język składający się ze znaczników oraz reguł ich poprawnego stosowania (gramatyki, semantyki), stosowany do pisania stron WWW. HTML jest teoretycznie aplikacją SGML, tzn. został zdefiniowany za pomocą SGML, będącego tzw. metajęzykiem (językiem służącym do definiowania innych języków).''\footnote{Źródło \url{http://pl.wikipedia.org/wiki/HTML}}

Wraz z rozwojem sieci WWW pojawiła się potrzeba rozwoju języka HTML tak, aby posiadał on możliwość dołączania do tekstów danych tabelarycznych, grafik czy plików multimedialnych. Kolejne wersje języka rozwijane były niezależnie przez producentów przeglądarek internetowych, co doprowadziło do częściowej  niekompatybilności wersji HTML zaimplementowanych w przeglądarkach różnych producentów. Próbą odpowiedzi na tę sytuację było stworzenie W3C\footnote{Zobacz \url{http://www.w3c.org/}} czyli World Wide Web Consortium, organizacji, która zajmuje się ustanawianiem wspólnych standardów HTML, a także innych spraw związanych z pisaniem stron WWW. Ostatnią wersją HTML jest wersja 4.01, która próbuje wydzielić zarządzanie wyglądem strony do kaskadowych arkuszy stylów (CSS). Na jakiś czas W3C zaprzestało rozwoju HTML i postanowiło dostosować język do formatu XML (ang. eXtensible Markup Language). W wyniku tego powstał XHTML, dla którego istnieje tryb zgodności z HTML, do wyświetlenia kodu XHTML w przeglądarkach zgodnych z HTML~4.01. Zmiana ta ma zapewnić większą rozszerzalność i dostępność języka. Z tego powodu właśnie XHTML jest obecnie zalecanym standardem tworzenia stron WWW. Obecną najnowszą wersją hipertekstu na potrzeby stron WWW jest XHTML~1.1\footnote{Zobacz \url{http://www.w3.org/TR/xhtml11/}}, wraz z arkuszami styli CSS~2.1\footnote{Zobacz \url{http://www.w3.org/TR/REC-CSS2/}}. Kolejną wersją języka (X)HTML miał być XHTML 2.0, jednak ta droga rozwoju została ostatecznie uznana za nietrafioną i rozwój XHTML~2.0 został zarzucony na rzecz HTML~5\footnote{Zobacz \url{http://www.w3.org/html/wg/html5/}}, nad rozwojem którego trwają obecnie intensywne prace.

\section{CSS}
\label{sec:css}
,,Kaskadowe arkusze stylów (ang. Cascading Style Sheets, CSS) to język służący do opisu formy prezentacji (wyświetlania) stron WWW. Standard CSS został opracowany przez organizację W3C w 1996 r. jako potomek języka DSSSL przeznaczony do używania w połączeniu z SGML-em. Pierwszy szkic CSS zaproponował w 1994 r. Håkon Wium Lie.\footnote{Zobacz \url{http://www.w3.org/People/howcome/p/cascade.html}}''

Język CSS jest wykorzystywany do wspomagania czytników stron WWW w definiowaniu kolorów, czcionek, układów i innych aspektów prezentacji dokumentu. Głównym założeniem projektowym była separacja warstwy treści (zapisanej w HTML albo w podobnym języku znaczników) od warstwy prezentacji (zapisanej w CSS). Taka separacja znacznie podnosi dostępność treści, zapewnia dużo większą elastyczność i kontrolę nad aspektami prezentacyjnymi dokumentu. Dodatkowo redukuje powtarzalność w warstwie dokumentu (jeżeli chcemy np. aby wszystkie nagłówki były koloru zielonego, nie musimy go nadawać każdemu z nich z osobna). Arkusz CSS pozwala również na to, aby ta sama treść była wyświetlana w różny sposób na różnych urządzeniach (np. inaczej będziemy wyświetlać stronę na ekranie komputera, inaczej na telefonie komórkowym, a jeszcze inaczej w wersji do druku). Określa się też priorytety z jakimi należy nakładać kolejne właściwości. Najnowszą wersją standardu CSS jest obecnie wersja 2.1 -- trwają jednak prace, nad wersją trzecią\footnote{Zobacz \url{http://www.w3.org/Style/CSS/current-work}}.

\section{JavaScript}
\label{sec:javascript}
JavaScript jest skryptowym językiem programowania, który został opracowany przez firmę Netscape dla potrzeb stron internetowych. JavaScript jest wersją standaryzowanego języka ECMAScript\footnote{Pełny standard \url{http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf}}.

Nazwa nasuwa skojarzenie z językiem Java. Oba języki nie mają ze sobą wiele wspólnego, oprócz tego że ich składnia jest zaczerpnięta z języka C. W połączeniu z Document Object Model\footnote{Zobacz \url{http://www.w3.org/DOM/}}, JavaScript stał się o wiele bardziej potężną techniką niż przewidywali jej twórcy. Po załadowaniu strony programista ma możliwość manipulacji strukturą dokumentu (załadowanej do przeglądarki strony), może także tworzyć funkcje, które reagują na zdarzenia występujące w oknie przeglądarki (ruchy myszką, klikniecie, naciśnięcie klawisza na klawiaturze itd.). Połączenie języka HTML ze skryptami języka JavaScript nazywane jest Dynamic HTML (DHTML), czyli dynamiczny HTML, aby uwydatnić różnicę w stosunku do statycznych stron HTML. 

Przełomem w rozwoju techniki DHTML było udostępnienie obiektu XMLHttpRequest (XHR). Umożliwia on wysyłanie żądań HTTP z poziomu języka JavaScript już po załadowaniu strony internetowej w trakcie interakcji z użytkownikiem. Otrzymane odpowiedzi serwera są wówczas wykorzystywane do modyfikacji załadowanego dokumentu. Możliwość asynchronicznego wykonywania żądań sprawia, że są one wykonywane w tle i nie przerywają interakcji użytkownika ze stroną, dynamicznie ją zmieniając. Technika wykorzystania obiektu XHR została nazwana AJAX (ang. Asynchronous JavaScript and XML, asynchroniczny JavaScript i XML). Dzisiaj każda przeglądarka udostępnia metody XHR. Technika AJAX sprawdza się tam gdzie nie ma potrzeby przeładowywania całej strony, a tylko jej części lub gdzie w ogóle nie trzeba dokonywać przeładowania a jedynie wysłać informację do serwera WWW. Rozwiązanie to, oszczędza czas użytkownika (w trakcie doładowywania informacji może on przeglądać stronę, która dalej jest dla niego dostępna) oraz zmniejsza obciążenie serwera (doładowywanie tylko części informacji zamiast całej strony ogranicza ilość danych wysyłanych do przeglądarki). 

\section{RSS}
\label{sec:rss}
RSS (ang. Really Simple Syndication, bardzo proste rozpowszechnianie artykułów) jest to format języków znacznikowych używany do publikowania często zmieniającej się treści, takiej jak wpisy na blogach, nagłówki wiadomości, podkasty itd. Dokument RSS zawiera zazwyczaj podsumowanie przypisanej mu strony WWW lub jej pełną zawartość. 

Technika RSS umożliwia ludziom, bycie na bieżąco ze stronami internetowymi dzięki automatycznym programom zwanymi ,,czytnikami RSS''. Aplikacje te, zbierają wiadomości z witryn wybranych przez użytkownika, a następnie przedstawiają w skondensowanej i przystępnej formie. Dzięki temu, nie ma potrzeby odwiedzania każdej witryny -- wszystkie można przeglądać z poziomu jednej aplikacji. W praktyce oznacza to znaczną oszczędność czasu. Zasada działania agregatora RSS jest prosta. Co jakiś czas (aplikacja działająca w tle, lub agregator internetowy\footnote{Na przykład \url{http://reader.google.com/}}) lub przy każdym uruchomieniu następuje sprawdzenie wszystkich wpisanych kanałów RSS, pod kątem nowej zawartości. Jeśli zostanie odnaleziona, następuje jej ściągnięcie i oznaczenie jako nieprzeczytanej. 

Oczywiście wiadomość RSS nie jest w żaden sposób ograniczona w stosunku do normalnej strony WWW. Z racji tego, że jest to zwykły plik XML, może zawierać odnośniki, grafikę a nawet informacje multimedialne. Każda wiadomość RSS zawiera także hiperlink do oryginału (co jest istotne w przypadku skrótów). 

Wyróżnia się następujące wersje protokołu RSS:
\begin{itemize}
  \item Really Simple Syndication (RSS 2.0)
  \item RDF Site Summary (RSS 1.0 i RSS 0.90)
  \item Rich Site Summary (RSS 0.91).
\end{itemize}

Wszystkie powyższe wersje są wstecznie zgodne.

\section{YAML}
\label{sec:yaml}
Format YAML to łatwy w odczycie dla człowieka sposób serializacji danych, który odziedziczył rozwiązania z języków takich jak XML, C, Python czy Perl. YAML po raz pierwszy zaprezentował Clark Evans w 2001 roku.

YAML to akronim rekursywny oznaczający ,,YAML Ain't a Markup Language'' (YAML nie jest językiem znaczników). Na początku rozwoju słowo YAML oznaczało ,,Yet Another Markup Language'' (kolejny język znaczników), ale rozwinięcie zostało zmienione głównie po to aby zwrócić uwagę, że YAML koncentruje się na samej informacji, a nie jej reprezentacji i semantyczności.

YAML został zaprojektowany w taki sposób, aby był łatwy do przenoszenia na typy danych stosowane w językach wysokiego poziomu -- listy, hashe i tablice. Język ten świetnie nadaje się do zastosowań, w których niezbędna jej ingerencja człowieka nie znającego rozwiązań zastosowanych w aplikacji -- czyli do plików konfiguracyjnych, nagłówków, informacji zwrotnych i kontrolnych. Jego prosta i klarowna struktura znacznie ułatwia projektowanie takich plików i późniejsze przenoszenie informacji między systemami.

\section{Przeglądarki internetowe}
\label{sec:przegladarki}

Przeglądarka internetowa jest to aplikacja, służąca do pobierania i wyświetlania treści tzw. stron internetowych. Strony internetowe to dokumenty w jednym z języków SGML (najczęściej HTML, XHTML lub XML), zawierające tekst, grafikę i pliki multimedialne.

Na rynku istnieje wiele przeglądarek, jednak tak naprawdę nie jest istotna ich nazwa, a silnik jaki wykorzystują do wyświetlania stron. Cztery najważniejsze silniki to: Trident (Internet Explorer), Gecko (np. Firefox, Netscape, Flock, SeaMonkey, Camino), KHTML/WebKit (np. Konqueror, Safari), oraz Presto (Opera). Oprócz przeglądarek graficznych warto jeszcze wspomnieć o przeglądarkach w trybie tekstowym. Są to Lynx, Links i eLinks -- z czego ta ostatnia, potrafi renderować JavaScript. Jeżeli chodzi o udział przeglądarek w rynku przedstawia się jak na rysunku \ref{fig:przegladarki} (\emph{Źródło:~http://marketshare.hitslink.com/report.aspx?qprid=0}). W polsce, dobrym miernikiem popularności jest serwis \url{http://www.ranking.pl/}.
\begin{figure}[h]
  \begin{center}
  \includegraphics{browsers.png}
  \caption{
  Udział procentowy w rynku przeglądarek internetowych.\label{fig:przegladarki}}
  \end{center}
\end{figure}

Niestety silniki przeglądarek nie są ze sobą kompatybilne. Każdy trochę inaczej interpretuje HTML, CSS, JavaScript. Nie wszystkie mają wbudowane najnowsze techniki w tym samym stopniu. Największe trudności sprawia twórcom stron przeglądarka Internet Explorer w wersji 6, która zajmuje największą część rynku i zarazem jest najbardziej przestarzałą (2001 r.). Ta wersja jest niezgodna ze standardami zatwierdzonymi przez W3C i posiada wiele błędów, często nazywana jest ,,zmorą programistów''. Niestety przeglądarka IE 6 wygrała pierwszą ,,wojnę przeglądarek''\footnote{Zobacz \url{http://en.wikipedia.org/wiki/Browser_wars}} i niemalże zmonopolizowała rynek. Następna wersja Internet Explorera (wersja 7) pojawiła się dopiero pod koniec 2006 roku. Zanim wersja 6 zniknie z rynku minie jeszcze kilka lat, w czasie których rozwój aplikacji po stronie klienta będzie ograniczony możliwościami tej przeglądarki.

\chapter{Koncepcje w aplikacjach internetowych}
\label{cha:koncepcje}

\section{Model-view-controller}
\label{sec:mvc}
MVC (ang. Model-view-controller, model-widok-kontroler) to wzorzec projektowy stosowany szeroko w informatyce, niemniej największą popularność zyskał w Internecie. Odpowiednie użycie wzorca oddziela logikę biznesową od warstwy prezentacji, co w efekcie przekłada się na możliwość zmiany wyglądu aplikacji bez wpływu na logikę biznesową i odwrotnie. We wzorcu MVC komponent o nazwie Model reprezentuje informacje o aplikacji i założeniach biznesowych użytych w celu obróbki danych. Widok, odpowiada za elementy UI (ang. User Interface, interfejs użytkownika) takie jak tekst, listy, pola wyboru itd. Kontroler spaja wszystko w całość pośrednicząc między Modelem a Widokiem i zajmując się sterowaniem sposobem działania aplikacji.

\subsection{Krótka historia}
\label{subsec:mvc-historia}
Wzorzec MVC został po raz pierwszy opisany w 1979~r.\footnote{Zobacz \url{http://heim.ifi.uio.no/~trygver/themes/mvc/mvc-index.html}} przez Trygve Reenskaug pracującegp wtedy w XEROX~PARC nad językiem Smalltalk\footnote{Zobacz \url{http://www.smalltalk.org/}}. Oryginalna implementacja została dokładnie opisana w dokumencie \emph{Applications Programming in Smalltalk-80: How to use Model-View-Controller.}\footnote{Zobacz \url{http://st-www.cs.uiuc.edu/users/smarch/st-docs/mvc.html}}

Po pewnym czasie powstało wiele odmian koncepcji. Warto wspomnieć o wzorcu Model-view-presenter, który powstał początkiem lat 90 i został zaprojektowany jako następca koncepcji MVC. Nie zmienia to faktu, że wzorzec MVC trzyma się mocno i wciąż znajduje szerokie zastosowanie.

\subsection{Opis wzorca}
\label{subsec:mvc-opis}
Dość powszechnie stosowanym rozwiązaniem jest dzielenie aplikacji na warstwę prezentacji i warstwę logiczną. Wzorzec MVC idzie o krok dalej, dzieląc warstwę prezentacji na Widok i Kontroler. Podział kładzie większy nacisk na architekturę aplikacji niż typowy wzorzec projektowy. Trzy jego główne elementy to:
\begin{itemize}
  \item \emph{Model} -- Specyficzna dla każdego projektu reprezentacja informacji, z którymi działa aplikacja. Jest to język DSL (ang. Domain Specific Language, zob.~rozdz.~\ref{sec:dsl} str.~\pageref{sec:dsl}), który opisuje zależności i operuje na surowych danych (np. obliczenie czy dzisiaj użytkownik obchodzi urodziny, kosztu wszystkich towarów w koszyku). Wiele aplikacji wykorzystuje ściśle określony mechanizm przechowywania danych (w przypadku aplikacji internetowych, prawie zawsze jest to baza danych). Wzorzec MVC sam w sobie, nie określa metody przechowywania danych, ponieważ założenie jest takie, że danymi zajmuje się model.
  \item \emph{Widok} -- Przedstawia dane z modelu w postaci czytelnej dla użytkownika. Podejście MVC nie definiuje ścisłej relacji ilościowej pomiędzy Modelami a Widokami, co oznacza, że jeden Model może obsługiwać wiele widoków, jak również jeden Widok może otrzymywać dane od wielu Modeli.
  \item \emph{Kontroler} -- Odpowiada za proces interakcji między aplikacją a użytkownikiem. Pobiera ,,zapytania'' od użytkownika i przekazuje je Modelowi. Następnie zwraca użytkownikowi nowy widok z nowymi informacjami. Może również dokonywać zmian w danych opisywanych przez Model.
\end{itemize}

\subsection{Zastosowanie w aplikacjach internetowych}
\label{subsec:mvc-web}
Wzorzec MVC często znajduje zastosowanie w aplikacjach internetowych, gdzie widokiem jest aktualnie wyświetlana strona WWW, a kontroler to kod, który pobiera dane dynamiczne i wypełnia nimi szablony HTML. Model z kolei reprezentuje dane (zazwyczaj przechowywane w bazie danych lub plikach XML) oraz reguły biznesowe, które zamieniają te dane na informację przedstawianą potem użytkownikowi.

Mimo, że wzorzec jest dostarczany w wielu środowiskach, z których każde zawiera odmienny pomysł na jego implementację, generalna zasada jest taka sama:
\begin{enumerate}
  \item Użytkownik wykonuje jakąś akcję w interfejsie użytkownika (np. wciska guzik).
  \item Kontroler obsługuje nadchodzące wywołanie, często wykorzystując jakąs ustaloną metodę lub odwołanie.
  \item Kontroler informuje model o akcji użytkownika, czasami również modyfikuje jego stan (np. Kontroler uaktualnia zawartość koszyka).
  \item Widok wykorzystuje model (pośrednio) do wygenerowania odpowiedniego interfejsu użytkownika (np. wyświetla tabelkę z zakupami). Widok pobiera dane z modelu, ale sam model nie wchodzi w interakcję z Widokiem.
  \item Interfejs użytkownika oczekuje na kolejną akcję, co rozpoczyna cały cykl od początku.
\end{enumerate}

Rozdzielając elementy należące do Modelu od Widoków, koncepcja MVC znacznie zmniejsza skomplikowanie architektury programu i zwiększa przejrzystość i elastyczność.

\subsection{MVC w Ruby on Rails}
\label{subsec:mvc-ror}
TODO

\section{Mapowanie ORM}
\label{sec:orm}
Mapowanie obiektowo-relacyjne (z ang. Object-relational mapping) jest techniką programistyczną stosowaną do konwersji danych przy użyciu niekompatybilnych ze sobą relacyjnych baz danych i przy obiektowo zorientowanych językach programowania. W efekcie otrzymywany jest ,,wirtualny obiekt bazy danych'', który może być następnie użyty na poziomie kodu zadanego języka programowania. Istnieją zarówno darmowe jak i komercyjne rozwiązania mapowania ORM, niemniej sporo programistów wciąż stara się wdrażać swoje koncepcje.

\subsection{Opis problemu mapowania}
\label{subsec:orm-problem}
Zarządzanie danymi w programowaniu obiektowym zazwyczaj jest rozwiązane jako manipulowanie różnego rodzaju obiektami, które prawie nigdy nie są wielkościami skalarnymi. Dla przykładu, dany jest obiekt reprezentujący osobę w książce teleadresowej. Osoba taka, może mieć kilka numerów telefonów i kilka adresów (zameldowania, zamieszkania itd.). Obiekt reprezentujący taką osobę miałby kilka rekordów, które zawierałyby kolejno, dane osobowe, listę numerów telefonów i listę adresów. Oczywiście, lista telefonów może z kolei zawierać obiekty numerów telefonów (z osobnym wpisem, na operatora, numer kierunkowy itd.), lista adresów -- obiekt adresu itd. Dodatkowo, wszystkie te obiekty miałyby swoje własne metody, np. do zwracania telefonu domowego, preferowanego adresu itd.

Z drugiej strony, bazy danych mogą przechowywać tylko dane skalarne zorganizowane w tabelach.

Programista musi więc albo zorganizować podobne wartości obiektów jako dane dla tabeli, albo całkowicie uprościć strukturę kodu, do poziomu wartości skalarnych aby potem bezproblemowo umieszczać je w bazie. Podejście ORM wykorzystuje pierwsze rozwiązanie.

Cały problem polega na takiej organizacji tych obiektów, aby potem dało się je łatwo zapisać do bazy, jednocześnie nie tracąc samej struktury obiektu (w celu późniejszego odczytu). Obiekty takie muszą być więc łatwe do przenoszenia między kodem, a bazą danych.

\subsection{Implementacje}
\label{subsec:orm-implementacje}
Najpowszechniej stosowanym rozwiązaniem jest relacyjna baza danych, która poprzedziła narodziny koncepcji ORM w 1990 r. Relacyjne bazy danych, wykorzystują serie tabel do organizacji danych. Dane w różnych tabelach są ze sobą powiązane przy pomocy kluczy założonych na całe kolumny, a nie na poszczególne wartości. Może się okazać, że dane przechowywane w jednym obiekcie muszą być rozłożone na kilka tabel.

Model ORM powinien systematycznie przewidywać jakie tabele będą potrzebne do zapisania określonych obiektów i generować odpowiednie zapytania języka SQL. Różnice między sposobem organizacji danych w modelu obiektowo zorientowanym (w takich językach jak Java, C\# czy Ruby) a sposobem ich przechowywania w relacyjnej bazie danych (takiej jak Oracle czy PostgreSQL), pociągają za sobą następujące problemy:
\begin{itemize}
  \item wydajność,
  \item skalowalność,
  \item zarządzanie operacjami typu CRUD (patrz rozdz.~\ref{sec:crud}, str.~\pageref{sec:crud}) dla bardziej skomplikowanych relacji,
  \item uproszczenie i spójność kodu konieczna przy szybkim tworzeniu aplikacji,
  \item zarządzanie i elastyczność kodu.
\end{itemize}

Prawdziwą wartością podejścia ORM jest przede wszystkim oszczędność czasu i uproszczenie kodu (wszystkie skomplikowane operacje bazodanowe wzorzec ORM wykonuje za programistę). Dodatkowo mapowanie ORM zwiększa wydajność i skalowalność oraz minimalizuje problemy niekompatybilności architektur (dobry wzorzec obsługuje większość obecnie stosowanych systemów baz danych).

Powstało sporo aplikacji, które dostarczając zestaw klas i bibliotek automatyzują proces mapowania i odciążają programistę. Po podaniu im listy tabel w bazie, same wygenerują odpowiednie obiekty i zależności między nimi. Wracając do poprzedniego przykładu -- pytając taki obiekt o numer telefonu, w tle nastąpi utworzenie zapytania SQL, wysłanie go do bazy, przetworzenie wyniku, a następnie konwersja do postaci zgodnej z obiektem.

Z punktu widzenia programisty, nie powinno go zajmować jak to wszystko się odbywa -- powinien tylko wiedzieć, że zapisanie danej do obiektu, skutkuje zapisaniem jej w bazie.

W praktyce nie jest to takie proste. Nie jest możliwe stuprocentowe odwzorowanie wszystkich możliwych kombinacji zapytań. Wszystkie implementacje ORM mają margines błędu, który użytkownik może zniwelować tylko poprzez bezpośrednie wysłanie zapytania SQL do bazy. Dodatkowo, cały proces mapowania i unifikacji zapytań pociąga za sobą spadek wydajności (zapytania SQL z poziomu ORM są tworzone z myślą o jak największej elastyczności i uniwersalności, więc niekoniecznie muszą być najszybsze dla konkretnego przypadku).

\subsection{Zastosowanie w aplikacjach internetowych}
\label{subsec:orm-web}
Koncepcja ORM jest wykorzystywana we wszystkich nowoczesnych środowiskach webowych, ponieważ zdejmuje z programisty konieczność dbania o spójność danych w bazie, utrzymywania i rozłączania połączeń itd. Nie bez znaczenia jest też wsparcie dla różnych architektur bazodanowych. Często dzieje się tak, że po przeniesieniu aplikacji na nowy serwer okazuje się, że zmienił się silnik bazy danych. Wtedy wystarczy tylko jedna zmiana w pliku konfiguracyjnym, a całość powinna nadal działać.

Drugą, znaczącą zaletą jest to, że ORM wymusza spójność kodu (przynajmniej w kwestii obsługi bazy danych) -- oznacza to, że przy projektach pisanych przez wielu programistów, jest znacznie mniej nieścisłości -- wszyscy trzymają się jednej konwencji.

\section{Metodologia REST}
\label{sec:rest}
REST (ang. REpresentional State Transfer, reprezentacja stanu transferu) jest to styl w architekturze programowania przeznaczony dla multimedialnych systemów rozproszonych takich jak World Wide Web. Określenia ,,Representional state transfer'' i ,,REST'' zostały pierwszy raz zaprezentowane w 2000 roku w rozprawie doktorskiej, której autorem był Roy Fielding\footnote{Zobacz http://www.ics.uci.edu/~fielding/pubs/dissertation/rest\_arch\_style.htm} -- jeden z głównych twórców specyfikacji protokołu HTTP. Zwroty te, szybko rozpowszechniły się wśród sieciowej społeczności.

Termin REST ściśle odnosi się do założeń sieciowych, które określają jak zasoby są definiowane i adresowane. Określenie to, jest też często używane w luźnym sensie, do opisania jakiegokolwiek prostego interfejsu, który przesyła informacje określone w danej domenie (patrz rozdz.~\ref{sec:dsl}, str.~\pageref{sec:dsl}) poprzez protokół HTTP wraz z dodatkową warstwą opisu wiadomości, taką jak SOAP (ang. Simple Object Access Protocol) czy też kontrolą sesji wykorzystującą ,,ciasteczka''. Zastosowanie protokołu HTTP może uzupełniać projekt REST, lub zburzyć jego filozofię. Jest możliwe zaprojektowanie dużej, skomplikowanej aplikacji w metodologii REST, jednocześnie nie używając HTTP i nie łączac jej z WWW. Jednakże, jest także możliwe zbudowanie prostej aplikacji XML+HTTP, która zupełnie nie spełnia założeń REST. Te różnice w używaniu terminu ,,REST'', często prowadzą do nieporozumień w dyskucjach technicznych.

Systemy, które spełniają założenia REST, często bywają określane jako ,,RESTful''.

\subsection{Założenia projektowe}
\label{sub:rest-zalozenia}
Najważniejszym założeniem w metodologii REST jest istnienie zasobów (źródeł określonej informacji), z których każdy może być zaadresowany przy użyciu globalnego odnośnika URI (ang. Uniform Resource Identifier, jednoznaczny identyfikator zasobu). Aby modyfikować te zasoby, komponenty sieci (klienci i serwery) komunikują się między sobą przez zestandarazywany interfejs (np. HTTP) i wymieniają między sobą reprezentacje tych zasobów (dokumenty zawierające określone informacje). Dla przykładu zasób ,,okrąg'' może przyjmować i zwracać reprezentację w postaci współrzędnych środka i promienia, skonwertowaną do formatu SVG, ale może też to być plik tekstowy zawierający trzy współrzędne po średniku, które leżąc na tym okręgu definiują go jednoznacznie.

Zwolennicy techniki REST utrzymują, że skalowalność i możliwość rozwoju sieci są bezpośrednim wynikiem kilku kluczowych założeń:
\begin{itemize}
  \item stany i funkcjonalności aplikacji są podzielone między zasoby,
  \item każdy zasób jest unikalnie adresowalny z użyciem uniwersalnej składni do tworzenia odnośników,
  \item wszystkie zasoby dzielą jednolity interfejs do transferu stanów pomiędzy klientem a zasobem, zawierający:
  \begin{itemize}
    \item ograniczony zestaw dobrze opisanych rozkazów,
    \item ograniczony zestaw typów danych, może jednak być wysłany w ramach ,,kodu na żądanie'',
  \end{itemize}
  \item protokół, którego cechami są:
  \begin{itemize}
    \item klient-serwer,
    \item bezstanowość,
    \item możliwość zapisywania stanu,
    \item warstwowość.
  \end{itemize}
\end{itemize}

Tak sformułowane założenia stanowią bazę do projektu zgodnego z metodologią REST.
\subsection{Zastosowanie w aplikacjach internetowych}
\label{rest:web}

World Wide Web jest kluczowym przykładem projektu typu ,,RESTful''. Większość założeń systemu WWW, pokrywa się z założeniami REST. Sieć opiera się na protokole HTTP, prezentacji treści w postaci dokumentów HTML oraz różnych innych technikach internetowych, jak np. system DNS (Domain Name System, system nazw domenowych).

Plik HTML może zawierać kod języka JavaScript i applety Java, aby wspierać kod na żądanie, oraz posiada wbudowaną obsługę hiperlinków.

Protokół HTTP jest jednolitym interfejsem dostępu do zasobów, który zawiera adres URI, metody, kody stanu, nagłówki i zawartość opisaną typem MIME (ang. Multipurpose Internet Mail Extensions, rozszerzenia poczty internetowej stosowane do różnych celów).

Najważniejszymi metodami protokołu HTTP są POST, GET, PUT i DELETE (patrz rozdz.~\ref{sec:http}, str.~\pageref{sec:http}). Są one często porównywane do CREATE, READ, UPDATE i DELETE (CRUD, patrz rozdz.~\ref{sec:crud}, str.~\pageref{sec:crud}), które to pojęcia mają szczególne zastosowanie w bazach danych.

\begin{table}[h]
  \centering
    \begin{tabular}{|l|l|}\hline
    HTTP   & CRUD \\\hline
    POST   & Create, Update, Delete \\
    GET    & Read \\
    PUT    & Create, Update \\
    DELETE & Delete \\\hline
    \end{tabular}
  \caption{Porównanie zapytań HTTP z koncepcją CRUD\label{rest:crud}}
\end{table}

Protokół HTTP spełnia jedno z założeń metodologii REST -- jest bezstanowy. Każda wiadomość zawiera wszystkie informacje niezbędne do identyfikacji zapytania. W efekcie czego, ani klient, ani serwer nie muszą przekazywać żadnych stanów informacyjnych pomiędzy wiadomościami. Każdy stan, w którym jest serwer, może być zamodelowany jako zasób.

Ta bezstanowość może być naruszona gdy używamy ciasteczek do podtrzymywania sesji. Używanie ciasteczek często wiąże się z naruszeniami polityki prywatności i problemami bezpieczeństwa. Dodatkowo, pojawia się wiele nieścisłości i błędów jeśli do problemów z ciasteczkami dołożymy jeszcze obecność przycisku ,,wstecz'' w przeglądarce.

Nie bez znaczenia jest też fakt, że hipertekst HTML pozwala tylko na użycie zapytań typu ,,GET''. Dodatkowo dzięki użyciu formularzy jest jeszcze dostępny ,,POST''. Pozostałe metody HTTP nie są wspierane ani przez format HTML~4.01 ani XHTML~1.0.\footnote{Więcej informacji na http://www.w3.org/TR/2007/REC-wsdl20-adjuncts-20070626/\#\_http\_binding\_default\_rule\_method}

\section{Język DSL}
\label{sec:dsl}
Język DSL (z ang. Domain Specific Language, język określonego przeznaczenia) jest zaprojektowany do wykonywania tylko jednego, dokładnie określonego rodzaju zadań. Stanowi przeciwieństwo do języków ogólnego przeznaczenia takich jak Java czy C, których założeniem jest uniwersalność i możliwość zastosowania w jak największej liczbie przypadków. Przykładem realizacji DSLa jest np. język SQL -- zaprojektowany tylko i wyłącznie do obsługi baz danych. Termin DSL nie jest terminem nowym, jednak dopiero ostatnio zyskał sobie sporą popularność, szczególnie w projektach webowych. Powodem tego jest znaczny wzrost mocy obliczeniowej komputerów oraz elastyczność nowych języków generalnego przeznaczenia, która umożliwia pisanie własnych aplikacji DSL.

\subsection{Przykłady zastosowań}
\label{sub:zastosowania}

Można wykazać conajmniej kilka przykładów zastosowań dla języków typu DSL:
\begin{enumerate}
  \item wykorzystywanie samodzielnych aplikacji wywoływanych przez bezpośrednią akcję użytkownika (najczęściej z poziomu linii poleceń lub pliku Makefile), np. zestaw narzędzi GraphViz,
  \item Języki DSL, które są zaimplementowane przy użyciu systemów makr, a następnie są konwertowane lub rozszerzane do trybu zgodności z nadrzędnym językiem programowania ogólnego przeznacznia, podczas fazy kompilacji lub interpretowania
  \item Realizacje w całości napisane w języku programowania ogólnego przeznaczenia (takim jak C lub Perl), mające na celu wykonywanie określonych operacji i zwracanie danych, które język nadrzędny jest w stanie zinterpretować i przetworzyć. Generalnie, można to rozumieć jako język programowania szczególnego przeznaczenia napisany w języku programowania ogólnego przeznaczenia.
  \item samodzielne funkcjonalnie części aplikacji -- dobrym przykładem są tu różnego rodzaju systemy makr w arkuszach kalkulacyjnych, wykorzystywane do uruchamiania specyficznych funkcji napisanych przez użytkownika, lub tworzone dynamicznie przez samą aplikację.
\end{enumerate}

Wiele języków DSL może być używane w kilku powyższych przypadkach naraz.

\subsection{Zastosowanie w aplikacjach internetowych}
\label{dsl:web}
W aplikacjach internetowych systemy DSL znalazły szerokie zastosowanie przy zadaniach często powtarzających się, takich jak na przykład tworzenie modeli, testy czy obsługa baz danych -- głównie dzięki językowi SQL. Używając systemów DSL, można zautomatyzować procesy takie jak:
\begin{itemize}
  \item wysyłanie aplikacji na serwer,
  \item synchronizacja z systemem kontroli wersji np. SVN (z ang. SubVersioN),
  \item testowanie aplikacji oraz jej poszczególnych komponentów,
  \item wiele różnych akcji związanych z przejściem z trybu rozwojowego na produkcyjny, jak np.:
  \begin{itemize}
    \item kompresja i obfuskacja (zaciemnienie) plików JavaScript,
    \item kompresja CSS,
    \item usuwanie informacji o składowej gamma z plików PNG (ang. Portable Network Graphics, przenośna grafika sieciowa),
    \item zmiany nazw plików, aby zostały ponownie pobrane (dotyczy to w szczególności serwisów, gdzie wymuszany jest nieskończony czas składowania plików przez przeglądarkę),
    \item czyszczenie różnych pozostałości procesu rozwijania kodu (stare, skompilowane pliki szablonów, logi, itd.).
  \end{itemize}
\end{itemize}

\section{Metody CRUD}
\label{sec:crud}
Akronim CRUD (Create, read, update and delete -- utwórz, odczytaj, popraw i skasuj) oznacza cztery podstawowe funkcje dotyczące operacji na danych. Czasami w skrócie tym, zamiast ,,read'' używa się ,,restore'' a zamiast ,,delete'' -- ,,destroy''. Termin ten często jest stosowany przy opisywaniu operacji na bazach danych lub przy opisie interfejsów.

\subsection{CRUD w relacyjnych bazach danych}
\label{sub:crud-db}
Skrót CRUD jest często odnoszony do relacyjnych baz danych, ponieważ te cztery operacje determinują zupełność operacji na takiej bazy danych. Każda litera akronimu, może zostać przedstawiona jako odpowiednia funkcja SQL.
\begin{table}[h]
  \centering
    \begin{tabular}{|l|l|} \hline
    Operacja         & SQL \\\hline
    Create           & INSERT \\
    Read (Retrieve)  & SELECT \\
    Update           & UPDATE \\
    Delete (Destroy) & DELETE \\\hline
    \end{tabular}
    \caption{Mapa akronimu CRUD na zapytania SQL\label{crud:sql}}
\end{table}
Pomimo iż pojęcie CRUD głównie odnosi się do relacyjnych baz danych, często jest też stosowany w odniesieniu do baz danych obiektowych (lub w formacie XML), plików tekstowych, nośników informacji itd.

\subsection{Zastosowanie w aplikacjach internetowych}
\label{crud:web}
W aplikacjach internetowych, termin CRUD odnosi się wyłącznie do interfejsu. Dla przykładu, jeśli tworzona jest książka teleadresowa, podstawową jednostką danych jest informacja o kontakcie. Jako niezbędne minimum, aplikacja musi:

\begin{itemize}
  \item utworzyć lub dodać nowy kontakt (Create),
  \item wyświetlić istniejące wpisy (Read),
  \item zmieniać niektóre informacje (Update),
  \item usuwać niepotrzebne kontakty (Delete).
\end{itemize}

Bez którejkolwiek z powyższych operacji, aplikacja nie może być uznana za kompletną. Zasada ta, jest też podwaliną każdego dobrego zintegrowanego środowiska programistycznego, gdyż zautomatyzowanie jej znacznie skraca czas tworzenia programu.

\section{Reguła DRY}
\label{sec:dry}
Reguła DRY (z ang. Don't Repeat Yourself, nie powtarzaj się) jest filozofią, której celem nadrzędnym jest zredukowanie duplikatów każdego rodzaju. Idea DRY zakłada, że ta sama informacja nie powinna być powielana w ramach jednego projektu, gdyż taka duplikacja znacznie utrudnia zmiany, zmniejsza czytelność i prowadzi do niespójności. Don't Repeat Yourself jest głównym przykazaniem książki \emph{The Pragmatic Programmer}\footnote{TODO: BIBLIOGRAFIA}, której autorami są Andy Hunt i Dave Thomas. W publikacji tej, zalecają, aby używać jej w jak najszerszym zakresie, włączając ,,schematy baz danych, plany testów, budowany system, a nawet dokumentację''\footnote{Wywiad Billa Vennersa z Dave Thomasem \emph{Orthogonality and the DRY Principle}, zob.~\url{http://www.artima.com/intv/dry.html}}. Kiedy reguła DRY zostanie pomyślnie wdrożona w system, jakakolwiek zmiana jakiegoś elementu w kodzie nie wpłynie w żaden sposób na elementy nie będące z nim logicznie połączone. Dodatkowo, wszystkie elementy logicznie połączone ze zmienionym, zmienią się w sposób przewidywalny i wciąż będą ze sobą zsynchronizowane.

\subsection{Ograniczenia idei DRY}
\label{sub:dry-not}
Reguła DRY nie zawsze się sprawdza i w niektórych przypadkach, lepiej z niej zrezygnować.
\begin{itemize}
  \item W małych projektach, albo prostych skryptach, wysiłek jaki trzeba włożyć, aby trzymać się reguły DRY, byłby znacznie większy niż proste napisanie dwóch kopii tej samej danej w różnych miejscach.
  \item Wymuszanie filozofii w projektach, w których najważniejszą rolę w tworzeniu treści pełni społeczność (np. wikipedia), mogłoby znacznie ostudzić zapał ludzi do tworzenia nowych wpisów.
  \item Zarządzanie projektami i kontrolą wersji pozwala (a nawet) zaleca tworzenie kilku kopii. Dla przykładu, bardzo dobrym nawykiem jest tworzenie trzech środowisk dla jednej aplikacji -- produkcyjnego, testowego i rozwojowego. Dzięki temu mamy pewność, że rozwojowy albo testowy kod, nie będzie miał wpływu na stabilne wersje produkcyjne,
  \item Dokumentacja dla użytkowników końcowych (od komentarzy w kodzie, do drukowanych instrukcji) zawiera typowe informacje opisujące pewnie funkcjonalności kodu przeznaczone dla ludzi, którzy nie potrzebują lub nie mają czasu analizować całego listingu programu. Niestety zasada DRY zakłada, że jeśli taka dokumentacja nie stanowi jakiejś wartości dla samego kodu (a nie dla użytkowników), to powinna być generowana a nie pisana,
  \item Generatory kodu źródłowego - niepowtarzalność będzie skuteczna dla generatora samego w sobie, ale nie musi już być konieczna dla samego wygenerowanego źródła, które jest używane automatycznie i nikt nie będzie do niego zaglądał ani go zmieniał.
\end{itemize}

\subsection{Zastosowanie w aplikacjach internetowych}
\label{dry:web}
Reguła DRY świetnie sprawdza się we wszystkich projektach programistycznych, ale największe uznanie znalazła właśnie wśród programistów aplikacji internetowych. Specyfika Internetu jest inna niż środowiska izolowanego -- wszystkie zmiany zachodzą dużo szybciej. Czas życia przeciętnego projektu internetowego to kilka lat i w tym czasie musi on podlegać ciągłemu rozwojowi i przemianom. Gdyby nie zasada DRY, zmiany zachodziły by dużo wolniej, byłyby dużo trudniejsze do przeprowadzenia i pochłaniałyby więcej środków. Filozofia DRY (oczywiście w pełni respektowana) wymusza na programistach WWW porządek w kodzie, dzięki czemu taka aplikacja jest łatwa do przystosowania do zmiennych warunków rynkowych.

\section{Zasada Convention over Configuration}
\label{sec:coc}
Convention over Configuration (konwencje ponad konfiguracje) jest jedną z metodologii projektowania oprogramowania, która dąży do osiągnięcia minimalizacji liczby decyzji jakie muszą podjąć programiści zyskując dzięki temu prostotę bez utraty elastyczności.

Sformułowanie samo w sobie oznacza, że programista musi rozpatrywać tylko niekonwencjonalne aspekty aplikacji. Dla przykładu, klasie \emph{Sprzedaż} przypisana jest tabela domyślnie nazwana ,,sprzedaż''. Jeżeli teraz nie zostanie naruszona konwencja (czyli np. tabela nie zostanie nazwana ,,sprzedaż\_produktów''), to programista nie musi nigdzie określać nazwy tabeli i potem odwoływać się do niej w innych miejscach.

Im więcej dobrych konwencji w kodzie, tym na wyższym poziomie abstrakcji może się skupić programista, co oznacza, że mocniej zajmuje się aspektami logicznymi zagadnienia, a nie technicznymi.

\subsection{Geneza}
\label{sub:geneza}
Tradycyjnie, systemy internetowe potrzebowały ogromnej ilości różnych plików konfiguracyjnych, z których każdy opisywał inne ustawienia. Pliki te zawierały specyficzne informacje dla każdego projektu, zawierające wszystko -- od mapowania adresów URL, poprzez klasy, aż po konfiguracje tabel w bazie danych. Przy większej złożoności aplikacji rozmiar i liczba tych plików powiększała się.

Dobrym przykładem reguły Convention over Configuration jest system ORM (zob. rozdz.~\ref{sec:orm}, str.~\pageref{sec:orm}) Hibernate. Mapuje on tabele w bazach danych na świat obiektowy, wykorzystując w tym celu pliki XML. Większość informacji jest konwertowanych w myśl z góry ustalonych zasad. Nazwy klas są mapowane na identycznie nazwane tabele w bazie danych, a ich wartości -- na kolumny. Jest to konwencja ustalona przez autorów Hibernate i narzucona użytkownikom, tj. programistom, którzy używają tego projektu. Jeśli któryś programista potrzebuje, aby nazwy się różniły, zawsze może sobie ustalić wszystkie wyjątki w odpowiednim pliku konfiguracyjnym.

\subsection{Zastosowanie w aplikacjach internetowych}
\label{coc:web}
Convention over Configuration jest koncepcją stosunkowo młodą, ale już zdobyła sobie rzesze zwolenników. Wynika to przede wszystkim z tego, że upraszcza wiele aspektów i sprawia, że z każdym nowym projektem twórcy nie muszą wciąż skupiać się na tych samych problemach. Poza tym, przy większych aplikacjach, nad którymi pracują dziesiątki programistów konwencje sprawiają, że każdy pisze w ten sam sposób i nie ma problemów w rodzaju -- ,,Co ta metoda robi?''. Dodatkowo złamanie konwencji wiąże się ze sporą nadprodukcją kodu, co niejako ,,samo z siebie'' wymusza w programistach dyscyplinę.

\chapter{Realizacja serwisu WWW}
\label{cha:app}
Temat pracy z góry narzucał cel projektu. Jest nim strona Kierunku Elektronika i Telekomunikacja\footnote{Zobacz. http://eit.agh.edu.pl/}. Motywem takiego wyboru była przestarzałość serwisu i niespójność kodu. Przez kilka lat od momentu stworzenia, aplikację rozwijało wiele różnych osób, skutkiem czego kod zatracił swoją początkową ,,myśl przewodnią'' oraz znacznie stracił na czytelności. Głównym powodem było SCP (ang. Speaking Code Principle) kodu stworzonego w Ruby~on~Rails. Dzięki filozofii DRY (zob. rozdz.~\ref{sec:dry}, str.~\pageref{sec:dry}) oraz Convention over Configuration (zob. rozdz.~\ref{sec:coc}, str.~\pageref{sec:coc}) każdy kawałek kodu ma ściśle określone miejsce w aplikacji. Dodatkowo sama struktura plików projektu Rails jest klarowna i przejrzysta. Zawsze w tym samym miejscu przechowywane są modele, widoki, biblioteki, kontrolery itd. Dzięki temu przekazanie serwisu w ręce nowego programisty, powinno odbyć się bezproblemowo. Dodatkowo czytelność kodu Ruby i łatwość tworzenia DSL (zob. rozdz.~\ref{sec:dsl}, str.~\pageref{sec:dsl}) sprawia, że taki kod od razu przekazuje intencje autora. I stąd właśnie bierze się jego samoopisywalność.

\section{Opis funkcjonalny aplikacji}
\label{sec:funkcjonalny}
Głównym założeniem serwisu projektu Kierunku Elektroniki i Telekomunikacji (zwanego dalej EiT) jest stworzenie portalu zawierającego wszelkie niezbędne studentowi informacje. Na funkcjonalności te składają się przede wszystkim:
\begin{itemize}
  \item system aktualności i najświeższych informacji dla studentów,
  \item dziekanatowe informacje o:
  \begin{itemize}
    \item planach zajęć,
    \item praktykach,
    \item przedmiotach obieralnych,
    \item zajęciach w języku angielskim,
    \item międzynarodowym programie edukacyjnym,
    \item wydarzeniach obowiązkowych w kalendarzu studenta (ferie, sesje itd.).
  \end{itemize}
  \item system zarządzania materiałami i ocenami,
  \item informacje o prowadzących,
  \item wszelkie dane dotyczące studiów podyplomowych.
\end{itemize}
Dodatkowo istotnym elementem jest warstwa administracyjna. Grupa ludzi opiekujących się stroną powinna mieć specjalne uprawnienia do dodawania informacji, usuwania niepotrzebnych treści, zarządzania danymi studentów (z poziomu systemu) itd. Dodatkowo, wszyscy prowadzący powinni mieć możliwość dodawania aktualności, materiałów i ocen. 

Wymienione powyżej funkcjonalności uznane zostały za najważniejsze i umieszczone w serwisie. Dotychczasowa strona EiT miała jeszcze dodatkowo forum i katalog linków. Uznano je jednak za zbyteczne. W obu przypadkach głównym powodem było znikome zainteresowanie studentów. Forum, z kolei, (zwane Hydeparkiem) przestało pełnić swoją pierwotną funkcję. W dzisiejszych czasach istnieją setki serwisów pozwalające założyć wìasne, darmowe forum jednym kliknięciem myszki. I właśnie na takie biuletyny przenieśli się studenci, tworząc fora swoich lat bądź grup dziekanatowych. Nie bez znaczenia jest też fakt, że do Hydeparku dostęp mieli prowadzący co z miejsca ucinało niektóre rodzaje konwersacji.

Kolejną niesłychanie istotną cechą serwisu jest jego bezpieczeństwo. W przypadku serwisu EiT sprawa jest o tyle poważna, że jest to aplikacja przeznaczona dla osób z dużą wiedzą techniczną, którzy doskonale orientują w świecie nowoczesnych technik. Najmniejsze niedopatrzenie może się zakończyć kompromitacją witryny. Autor niniejszej pracy od wielu lat zajmuje się tematyką szeroko pojętego bezpieczeństwa. I to zarówno od strony aplikacyjnej (pisanie bezpiecznego kodu) jak i serwerowej (zabezpieczanie maszyn przed intruzami). W związku z tym, od początku każdy element strony był szczegółowo analizowany pod tym kątem. Nie bez znaczenia jest też fakt, że system Ruby~on~Rails przychodzi z wieloma rozwiązaniami ochronnymi w standardzie. Dla przykładu, jeśli nastąpi jakiś błąd w działającej aplikacji, to w odróżnieniu od PHP nie pojawi się komunikat dokładnie informujący, który wiersz w którym pliku go wywołał. Zamiast tego, wyświetli się informacja dla użytkownika, a sam błąd zostanie zapisany do logów administratora. Dzięki temu, potencjalny atakujący nie otrzymuje żadnej informacji o serwisie, poza tym, że działając tak i tak można uszkodzić aplikację -- co nie jest wartościową informacją samo w sobie.

Sama szata graficzna pozostała niezmieniona, natomiast musiał zmienić się jej kod. Wynika to z zupełnie nowej filozofii tworzenia widoków. Poza tym, stary kod HTML nie był w ogóle semantyczny, co znacznie utrudniało pracę robotom wyszukiwarek i skutkowało niższymi pozycjami w rankingach. Cały HTML został przepisany na nowo (już jako XHTML) i stworzone zostały nowe arkusze stylów. Zmieniła się też organizacja menu -- kliknięcie w pozycję nie odświeża strony, tylko od razu rozwija listę podmenu. Zmniejsza to znacznie liczbę zapytań (wcześniej użytkownik musiał otworzyć nową stronę, tylko po to, żeby zobaczyć rozwinięte menu i przejść do kolejnej strony) oraz skraca czas interakcji ze stroną. A wszystko to, dzięki zastosowaniu języka JavaScript.

Jak już nadmienione zostało wcześniej -- Ruby nie jest zbyt szybkim językiem. Dlatego wszelkie działania mające na celu optymalizację kodu są wysoce pożądane. Bardzo istotne jest zwracanie uwagi na takie szczegóły, jak wyciąganie deklaracji zmiennych poza pętle, optymalizacje warunków (ważna jest tu znajomość praw deMorgana), przypisywanie obiektów do zmiennych itd. Zastosowany też został dużo wydajniejszy serwer WWW aniżeli dostarczany w standarcie WebRick --- Mongrel\footnote{Zobacz \url{http://mongrel.rubyforge.org/}}

\section{Środowisko narzędziowe}
\label{sec:srodowisko}
W kolejnych podrozdziałach opisane zostały użyte narzędzia i środki do implementacji aplikacji.

\subsection{Ruby i pochodne}
\label{sub:ruby-etc}
Ruby jest językiem międzyplatformowym, co oznacza, że jego interpreter jest dostępny pod prawie każdym systemem operacyjnym. Niestety implementacja pod systemem Windows pozostawia wiele do życzenia. Bierze się to stąd, że Ruby został pierwotnie stworzony na systemach Uniksowych a następnie przeniesiony na platformę Windows. Przy takiej skali skomplikowania języka, brak optymalizacji pod konkretny system daje się odczuć. Różnice w czasach wykonania aplikacji potrafiły przekroczyć 100\%! Do realizacji niniejszej pracy korzystano z Linuksa a konkretniej z dystrybucji Slackware Linux. Natomiast do pracy z Ruby zaleca się jakąkolwiek dystrybucje UNIXopodobną (włączając to MAC~OS~X).

System operacyjny Slackware~12.0 ma interpreter Ruby w standardzie (przy maksymalnej instalacji). W razie jego braku, należy pobrać odpowiednią paczkę -- Ruby~1.8.6\footnote{Do pobrania m.in. na \url{http://linuxpackages.telecoms.bg/Slackware-11.0/ken/ruby-1.8.6-i486-1kjz.tgz}}. Dodatkowo potrzebny jest pakiet RubyGems~0.9.2\footnote{Do pobrania m.in. na \url{http://linuxpackages.telecoms.bg/Slackware-11.0/ken/rubygems-0.9.2-noarch-1kjz.tgz}}.

Po instalacji użytkownik otrzymuje w pełni funkcjonujący interpreter języka Ruby, w którym jednak brakuje jeszcze kilku bibliotek. Do ich instalacji należy posłużyć się narzędziem RubyGems.

Moduł Gem to spakowana aplikacja lub biblioteka języka Ruby. Zarządzanie gemami odbywa się za pośrednictwem polecenia \emph{gem}. Daje ono możliwość instalacji, usuwania i zadawania pytań o pakiety. Narzędzie jest podobne do APT (ang. Advanced Packaging Tool, zaawansowane narzędzie paczkujące), systemu zarządzania pakietami używanym przez system Debian GNU/Linux.

Repozytorium gemów jest otwarte dla każdego, to znaczy że każdy może pobierać a także publikować swoje gemy.

W niniejszej pracy wykorzystano dwa gemy:
\begin{itemize}
  \item Ruby~on~Rails -- środowisko programistyczne w wersji 2.0.2,
  \item Mongrel -- serwer WWW w wersji 1.1.3.
\end{itemize}

\begin{figure}[h]
\centering
\begin{verbatim}# gem install rails --include-dependencies
# gem install mongrel --include-dependencies\end{verbatim}
\caption{Lista poleceń niezbędnych do zainstalowania wymaganych gemów\label{fig:gems}}
\end{figure}
Aby zainstalować wymagane gemy, z poziomu powłoki należy wykonać następujące polecenia (zob. rys.~\ref{fig:gems}), które zainstalują pakiety wraz ze wszystkimi zależnościami. Po ich wykonaniu, wymienione aplikacje są gotowe do użycia.

\subsection{Dodatkowe pakiety}
\label{sub:dodatkowe}
Poza środowiskiem Ruby~on~Rails aplikacja EiT korzysta jeszcze z dwóch zewnętrznych aplikacji -- serwera MySQL~5.0.37\footnote{Zobacz \url{http://www.mysql.com/}} oraz pakietu iconv\footnote{Zobacz \url{http://www.gnu.org/software/libiconv/}}. Pierwsza z nich, to relacyjna baza danych, druga -- pakiet konwertujący różne strony kodowe.

Serwer MySQL powinien być standardowo w dystrybucji Slackware. Jeśli go nie ma, należy ściągnąć odpowiedni pakiet\footnote{MySQL można pobrać z \url{ftp://ftp.slackware.com/pub/slackware/slackware-12.1/slackware/ap/mysql-5.0.51b-i486-1.tgz}}. Iconv stanowi część pakietu GLIBC (ang. GNU C Library, biblioteka GNU C)\footnote{Zobacz \url{http://www.gnu.org/software/libc/}} i jego status w systemie paczek jest \emph{required}, co oznacza, że na pewno jest zainstalowany. W razie jakichkolwiek problemów, należy ściągnąć najświeższą paczkę\footnote{GLIBC można pobrać z \url{ftp://ftp.slackware.com/pub/slackware/slackware-12.1/slackware/l/glibc-i18n-2.7-noarch-10.tgz}}.

Aby baza danych mogła działać poprawnie należy stworzyć katalog przechowywujący dane i tabele systemowe niezbędne do funkcjonowania bazy. Dodatkowo, dobrze jest ustawić, aby proces obsługujący bazę danych uruchamiał się przy każdym starcie systemu. Wszystko to osiągniemy, wykonując polecenia z rysunku~\ref{fig:mysql}.
\begin{figure}[h]
\begin{verbatim}# chmod +x /etc/rc.d/rc.mysqld
# /etc/rc.d/rc.mysqld start
# su - mysql
$ mysql_install_db\end{verbatim}
\caption{Lista poleceń niezbędnych do zainicjalizowania MySQL\label{fig:mysql}}
\end{figure}

Moduł iconv nie wymaga żadnych dodatkowych przygotowań.

\subsection{Aplikacje wspomagające tworzenie projektu}
\label{sub:ide}
Po przygotowaniu wszystkiego co niezbędne od strony serwera, trzeba jeszcze przygotować narzędzia wspomagające pisanie kodu -- tj. środowisko programistyczne (ang. IDE, Integrated Development Environment), aplikacje wspomagające pracę z bazą danych oraz przeglądarkę wraz z zestawem dodatków wspomagających pracę z gotowym kodem.

\subsubsection{Środowisko programistyczne}
\label{subsub:ide}
Najlepszym, zdaniem autora, edytorem wspomagającym tworzenie aplikacji Ruby~on~Rails jest TextMate\footnote{Zobacz \url{http://macromates.com/}}. Niestety jest on dostępny tylko dla systemów Mac~OS~X. Alternatywnie istnieje zintegrowane środowisko programistyczne NetBeans\footnote{Zobacz \url{http://www.netbeans.org/}}. Jest ono stworzone w języku Java i istnieją jego wersje dla systemów Linux, Windows, Mac~OS i Solaris. Ta praca powstała przy użyciu NetBeans w wersji 6.0beta1, niemniej obecnie jest już dostępna wersja 6.1\footnote{Do pobrania z \url{http://download.netbeans.org/netbeans/6.1/final/bundles/netbeans-6.1-ruby-linux.sh}}.

Do poprawnego działania edytora NetBeans potrzebny jest jeszcze pakiet JDK (ang. Java Development Kit, Zestaw narzędzi deweloperskich dla języka Java)\footnote{Do pobrania z \url{http://java.sun.com/javase/downloads/?intcmp=1281}}. Należy pamiętać, że dla dystrybucji Slackware należy pobrać wersję binarną z instalatorem, a nie paczkę RPM (ang. RPM Package Manager, zarządca pakietów RPM). Po ściągnięciu z sieci, należy ją uruchomić i odpowiedzieć na kilka pytań (m.in. o ścieżkę docelową). Analogicznie instaluje się pakiet NetBeans.

Jako dodatek użyteczny przy rozwijaniu kodu Rails, autor zaleca zainstalowanie wtyczki do NetBeans o nazwie \emph{Extra Ruby Color Themes} (Zakładka \emph{Tools}$\to$\emph{Plugins}), a następnie włączenie schematu kolorów \emph{Ruby Dark Pastels} (Zakładka \emph{Options}$\to$\emph{Fonts~\&~Colors}). Jest to schemat kolorów wzięty z TextMate, dużo czytelniejszy od domyślnego i mniej męczący wzrok.

\subsubsection{Aplikacje wspomagające pracę z bazą danych}
\label{subsub:querybrowser}
W celu uniknięcia wykonywania wszystkich niezbędnych działań na bazie z domyślnego interfejsu tekstowego, zalecane jest zainstalowanie graficznych narzędzi ułatwiających obsługę bazy. Te polecane narzędzia to:
\begin{itemize}
  \item MySQL Query Browser\footnote{Zobacz \url{http://www.mysql.com/products/tools/query-browser/}},
  \item MySQL Administrator\footnote{Zobacz \url{http://www.mysql.com/products/tools/administrator/}},
  \item DBDesigner\footnote{Zobacz \url{http://www.fabforce.net/dbdesigner4/}}.
\end{itemize}
Pakiet MySQL Query Browser ułatwia wykonywanie zapytań i przeglądanie danych, natomiast MySQL Administrator -- odpowiada za zarządzanie użytkownikami w bazie MySQL. DBDesigner jest narzędziem do graficznego projektowania bazy danych.

\subsubsection{Przeglądarki internetowe i dodatki}
\label{subsub:browser}
Z powodu niekompatybilności silników renderujących przeglądarek (zob. rozdz.~\ref{sec:przegladarki}, str.~\pageref{sec:przegladarki}), podczas pisania pracy, autor musiał korzystać aż z czterech przeglądarek internetowych, aby przetestować stronę pod najpopularniejszymi silnikami renderującymi:
\begin{itemize}
  \item \emph{Trident} -- Microsoft Internet Explorer 6.0 (pod Linuksem dostępny, dzięki pakietowi \emph{ies4linux}\footnote{Zobacz \url{http://www.tatanka.com.br/}}),
  \item \emph{Gecko} -- Mozilla Firefox 2.0.0.14\footnote{Zobacz \url{http://www.getfirefox.com/}},
  \item \emph{Presto} -- Opera 9.50\footnote{Zobacz \url{http://www.opera.com}},
  \item \emph{WebKit} -- Konqueror 3.5.8\footnote{Zobacz \url{http://www.konqueror.org}}.
\end{itemize}

W czasie projektowania i rozwijania aplikacji, autor korzystał z przeglądarki Mozilla~Firefox, która obecnie posiada najlepszy silnik renderujący. Dodatkowo można do niej zainstalować kilka, ułatwiających pracę dodatków:
\begin{itemize}
  \item \emph{Web Developer}\footnote{Zobacz \url{http://chrispederick.com/work/webdeveloper/}} -- pasek narzędzi, który posiada wiele opcji i udogodnień (np. zarządzanie ciasteczkami, zaznaczanie wybranych elementów dokumentu, podgląd bieżącego źródła, walidację HTML/CSS).
  \item \emph{FireBug}\footnote{Zobacz \url{http://www.getfirebug.com/}} -- narzędzie pozwalające na przeglądanie drzewa dokumentu HTML, podglądu i edycji jego poszczególnych elementów, przeglądanie i dynamiczną edycję arkuszy styli CSS, przeglądanie skryptów JavaScript oraz możliwości wykonywania instrukcji tego języka i obserwacji ich rezultatów, debugowanie skryptów, przeglądanie elementów DOM, a także obserwowanie wywołań XMLHttpRequest (zob. rozdz.~\ref{sec:javascript}, str.~\pageref{sec:javascript}).
  \item \emph{ColorZilla}\footnote{Zobacz \url{http://www.iosart.com/firefox/colorzilla/}} -- rozszerzenie bardzo użyteczne podczas projektowania wyglądu strony i tworzenia arkuszy CSS. Udostępnia ono narzędzie o nazwie pipeta (ang. color picker), która pozwala pobrać kolor dowolnego piksela w obrębie przeglądarki. Dzięki temu, nie trzeba za każdym razem zaglądać do styli, podczas tworzenia nowego arkusza CSS na bazie starego projektu.
  \item \emph{HTML Validator}\footnote{Zobacz \url{http://users.skynet.be/mgueury/mozilla/}} -- dodatek, który rozszerza podgląd źródła, dokumentu o numerację wierszy i walidator dokumentu HTML (na bazie silnika TIDY\footnote{Zobacz \url{http://tidy.sourceforge.net/}}). Dzięki temu, od razu widać, gdzie popełniono błąd w strukturze dokumentu (niedomknięty tag, brak cudzysłowu przy wartości, itd.).
  \item \emph{LiveHTTPHeaders}\footnote{Zobacz \url{http://livehttpheaders.mozdev.org/}} -- narzędzie służące do podglądu nagłówków z protokołu HTTP wysyłanych i odbieranych podczas każdego zapytania. Świetnie się sprawdza w przypadku błędnych przekierowań, kiedy nie wiadomo, w którym momencie doszło do zapętlenia programu.
\end{itemize}

\section{Projekt bazy danych}
\label{sec:db-projekt}
Zasada działania relacyjnej baz danych (jaką jest MySQL wykorzystywany w aplikacji), jak i technika odwzorowywania w niej rzeczywistych danych jest obszernym zagadnieniem. Czytelników zainteresowanych tym tematem odsyła się do znakomitego samouczka udostępnionego przez firmę Microsoft\footnote{Zobacz \url{http://office.microsoft.com/pl-pl/access/CH062526791045.aspx}}.

Projektując bazę programista powinien trzymać się konwencji nazewnictwa tabel oraz pól tabeli przyjętej przez Ruby~on~Rails. Zgodnie z konwencją, nazwy tabel powinny być w liczbie mnogiej w stosunku do nazwy modelu, który przechowuje informacje o danej tabeli. Klucz podstawowy tabeli powinien nosić nazwę \emph{id}, klucze obce powinny być nazwane zgodnie ze schematem \{nazwa obiektu w liczbie pojedynczej\}\_id. Dla potrzeb realizacji niniejszej pracy stworzono zgodnie z powyższymi wytycznymi nowy schemat bazy danych, przedstawiony na rysunku \ref{fig:database}.

\newpage
\thispagestyle{empty}
\addtolength{\textwidth}{4cm}
\addtolength{\hoffset}{-2.5cm}
\addtolength{\textheight}{5cm}
\addtolength{\voffset}{-3.5cm}
\begin{landscape}
\begin{figure}
\centering
%  \includegraphics{database.png}
  \caption{
  Schemat bazy danych EiT.
  \label{fig:database}
  }
\end{figure}
\end{landscape}
\newpage

\addtolength{\textwidth}{-4cm}
\addtolength{\hoffset}{2.5cm}
\addtolength{\textheight}{-5cm}
\addtolength{\voffset}{3.5cm}
\subsection{Opis tabel}
\label{sub:tabele}

W niniejszym rozdziale omówione zostały wszystkie tabele wraz ze znaczeniami poszczególnych kolumn (pól) oraz z rysunkiami poglądowymi. Rozdział ten stanowi dokumentację systemu dla osób mających zająć się jego utrzymaniem.

\subsubsection{Tabela \emph{users}}
\label{subsub:users}
Tabela ta zawiera zbiorcze informacje o użytkownikach mających dostęp do systemu (zarówno studentach, jak i prowadzących).

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id              & int(11)      & identyfikator użytkownika \\
  login           & varchar(50)  & login użytkownika \\
  password        & varchar(40)  & hasło użytkownika \\
  email           & varchar(50)  & email użytkownika \\
  created\_on      & date         & data utworzenia konta \\
  updated\_at      & datetime     & data ostatniego zalogowania\\
  firstname       & varchar(50)  & imię \\
  lastname        & varchar(50)  & nazwisko \\
  privileges      & int(11)      & przywileje w systemie \\
  question        & text         & pytanie ratunkowe \\
  answer          & text         & odpowiedź na pytanie ratunkowe \\
  www\_page        & varchar(200) & adres strony WWW użytkownika\\
  www\_description & text         & opis strony WWW \\
  voted           & tinyint(1)   & czy użytkownik zagłosował już w ankiecie? \\
  signature       & text         & sygnaturka użytkownika \\
  last\_ip         & varchar(15)  & ostatnie IP z którego logował się użytkownik \\
  activated       & tinyint(1)   & czy konto jest aktywne? \\\hline
  \end{tabular}
  \caption{Tabela \emph{users}\label{tab:users}}
\end{table}

\begin{itemize}
  \item Pole \emph{login} może być puste. Wraz z początkiem każdego roku akademickiego, dziekanat dostarcza listę nowych studentów. Osoby te są dopisywane do bazy danych. Później, jeśli któraś z nich zapragnie założyć konto podaje login, hasło oraz numer indeksu, które z miejsca stają się aktywne i włączają użytkownika do systemu. Takie rozwiązanie zapobiega założeniu konta przez osobę niepowołaną.
  \item Hasło użytkownika (\emph{password}) jest zahaszowane algorytmem SHA-1\footnote{Standard dostępny pod \url{http://csrc.nist.gov/publications/fips/fips180-2/fips180-2withchangenotice.pdf}}. Zabezpiecza to hasła użytkowników przed odczytem w przypadku skompromitowania (nieuprawnionego odczytu) bazy danych.
\begin{figure}[h]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|c|}\hline
    X & O & D & A & G & M & K & P \\\hline
  \end{tabular}
  \begin{itemize}
    \item $X_{128}$ -- nieużywany
    \item $O_{64}$ -- dodawanie i edycja ocen
    \item $D_{32}$ -- odczyt deklaracji studenckich
    \item $A_{16}$ -- dodawanie i edycja aktualności
    \item $G_8$ -- konfiguracja grup studentów
    \item $M_4$ -- dodawanie i edycja materiałów
    \item $K_2$ -- konfiguracja wydarzeń w kalendarzu studenckim
    \item $P_1$ -- administracja ankietami
  \end{itemize}
  \caption{Struktura pola \emph{privileges} w tabeli \emph{users}\label{fig:privileges}}
\end{figure}
  \item Struktura pola \emph{privileges} to maska, w której każdy bit określa inne uprawnienia jak opisuje to rysunek \ref{fig:privileges}. Wartość 1 -- oznacza przyzwolenie, 0 -- brak dostępu do danego zasobu.
  \item Pola \emph{question} i \emph{answer} nie są obowiązkowe, zabezpieczają jednak użytkownika przed utratą hasła. Po podaniu odpowiedzi na pytanie użytkownik jest z powrotem logowany do systemu, gdzie może zmienić swoje hasło.
  \item Pole \emph{signature} nie jest nigdzie używane -- zachowano je w celu uzyskania wstecznej zgodności i na poczet przyszłych zastosowań.
\end{itemize}

\subsubsection{Tabela \emph{cathedrals}}
\label{subsub:cathedrals}

Tabela ta zawiera wszystkie katedry obsługiwane przez system. Tablica~\ref{tab:cathedrals} pokazuje, że w tej tabeli znajdują się jedynie nazwy katedr.
\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id              & int(11)      & Identyfikator katedry\\
  name & varchar(50) & Nazwa katedry \\\hline
  \end{tabular}
  \caption{Tabela \emph{cathedrals}\label{tab:cathedrals}}
\end{table}

\subsubsection{Tabela \emph{specialities}}
\label{subsub:specialities}

Tabela ta zawiera wszystkie moduły obsługiwane przez system według struktury w tablicy~\ref{tab:specialities}. Jeden rekord ($id = 1$) nie ma opisu i zarezerwowany jest dla studentów, którzy jeszcze nie dokonali wyboru.
\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id              & int(11)      & Identyfikator modułu\\
  head & varchar(50) & Nazwa modułu \\\hline
  \end{tabular}
  \caption{Tabela \emph{specialities}\label{tab:specialities}}
\end{table}

~\newline

\subsubsection{Tabela \emph{users\_students}}
\label{subsub:users_students}

Tabela zawiera uzupełniające informacje o studentach. Nie ma w niej rekordów odpowiadających prowadzącym. Jej strukturę obrazuje Tablica~\ref{tab:users_students}.
\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id             & int(11)     & Identyfikator studenta \\
  user\_id       & int(11)     & \\
  speciality\_id & int(11)     & \\
  sgroup         & varchar(7)  & Grupa dziekanatowa (rys.~\ref{fig:group})\\
  sindex         & int(6)      & Numer indeksu \\
  gadu\_gadu     & int(15)     & Numer Gadu-Gadu \\
  icq            & int(15)     & Numer ICQ \\
  cell           & varchar(15) & Telefon kontaktowy \\\hline

  \end{tabular}
  \caption{Tabela \emph{users\_students}\label{tab:users_students}}
\end{table}

\begin{figure}[h]
  \centering
  \begin{tabular}{|c|c|c|c|}\hline
  K & R & R & S\\\hline
  \end{tabular}
  \begin{itemize}
    \item \emph{K} -- kod modułu (\emph{E} dla Elektroniki, \emph{K} dla Telekomunikacji)
    \item \emph{RR} -- dwie ostatnie cyfry roku rozpoczęcia studiów przez daną grupę
    \item \emph{S} -- kod specjalności
  \end{itemize}
  \caption{Struktura pola grupy\label{fig:group}}
\end{figure}

Na podstawie grupy dziekanatowej, obliczany jest rok studiów wg. wzoru \ref{equ:year} oraz zgodnie z rys.~\ref{fig:group}.

\begin{equation}
  rok = \left\{ \begin{array}{ll}
  obecny\_rok - 2000 - RR & gdy~miesiac \le 9\\
  obecny\_rok - 2000 - RR + 1 & gdy~miesiac > 9
  \end{array} \right.
  \label{equ:year}
\end{equation}

\newpage
\subsubsection{Tabela \emph{users\_lecturers}}
\label{subsub:users_lecturers}
Tabela zawiera informacje o prowadzących w.g. tablicy~\ref{tab:users_lecturers}. Studenci nie są do niej dopisywani.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id            & int(11)     & Identyfikator prowadzącego\\
  cathedral\_id & int(11)     & \\
  user\_id      & int(11)     & \\
  place         & varchar(30) & Pokój \\
  title         & varchar(50) & Tytuł naukowy \\
  consultations & varchar(50) & Terminy konsultacji \\
  phone         & varchar(15) & Telefon kontaktowy \\
  photo         & varchar(50) & Zdjęcie \\\hline
  \end{tabular}
  \caption{Tabela \emph{users\_lecturers}\label{tab:users_lecturers}}
\end{table}
Pole \emph{photo} zawiera tylko nazwę pliku ze zdjęciem. Model w aplikacji sam ustala ścieżkę.

\subsubsection{Tabela \emph{subjects\_types}}
\label{subsub:subjects_types}
Tabela zawiera kategorie (rodzaje) przedmiotów. Jest to istotne przy grupowaniu po kategoriach zgodnie z tablicą~\ref{tab:subjects_types}.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id        & int(11)     & Identyfikator rodzaju przedmiotu \\
  head      & varchar(50) & Nazwa rodzaju \\
  mandatory & tinyint(1)  & Czy obowiązkowy? \\\hline
  \end{tabular}
  \caption{Tabela \emph{subjects\_types}\label{tab:subjects_types}}
\end{table}

\newpage
\subsubsection{Tabela \emph{subjects}}
\label{subsub:subjects}
Tabela zawiera informacje o prowadzonych przedmiotach. Przedmiot liczy się jako całość (nie ma podziału na wykłady, laboratoria itd.) w obrębie jednego semestru.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id                 & int(11)      & Identyfikator przedmiotu\\
  subjects\_type\_id & int(11)      & \\
  acronym            & varchar(10)  & Skrót nazwy przedmiotu\\
  head               & varchar(255) & Nazwa przedmiotu \\
  body               & text         & Opis przedmiotu \\
  code               & varchar(6)   & Kod dziekanatowy \\
  season             & int(4)       & Semestr \\\hline
  \end{tabular}
  \caption{Tabela \emph{subjects}\label{tab:subjects}}
\end{table}

Pole \emph{season} oznacz semestr na którym dany przedmiot jest prowadzony. Jeśli wynosi 0, oznacza to przedmiot specjalny (np. Dziekanat).

\subsubsection{Tabela \emph{news\_types}}
\label{subsub:news_types}
Tabela ta zawiera kategorie aktualności.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id              & int(11)      & Identyfikator rodzaju aktualności\\
  name & varchar(20) & Rodzaj aktualności \\\hline
  \end{tabular}
  \caption{Tabela \emph{news\_types}\label{tab:news_types}}
\end{table}

\newpage
\subsubsection{Tabela \emph{news}}
\label{subsub:news}
Tabela ta zawiera wykaz aktualności sparametryzowanych jak to pokazuje tablica~\ref{tab:news}

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id             & int(11)      & Identyfikator aktualności \\
  news\_type\_id & int(11)      & \\
  user\_id       & int(11)      & \\
  subject\_id    & int(11)      & \\
  head           & varchar(255) & Tytuł aktualności \\
  body           & text         & Treść aktualności \\
  ip             & varchar(15)  & IP z której dodano aktualność \\
  date           & datetime     & Data dodania \\
  times\_readed  & int(11)      & Ilość przeczytań \\
  for\_year      & int(11)      & Dla których lat \\\hline
  \end{tabular}
  \caption{Tabela \emph{news}\label{tab:news}}
\end{table}

Pole \emph{for\_year} to maska bitowa roczników, których dotyczy aktualność, przy czym najmłodszy bit to pierwszy rok, najstarszy -- piąty. Jeżeli pole ma wartość ,,0'' lub ,,31'' to aktualność dotyczy wszystkich.

\subsubsection{Tabela \emph{uploaded\_files}}
\label{subsub:uploaded_files}
Tabela ta zawiera informacje o plikach (materiałach lub ocenach) załadowanych do systemu. Jest także tabelą pośredniczącą dla relacji wiele-do-wielu między prowadzącymi a przedmiotami (zob. rozdz.~\ref{subsub:users-subjects}, str.~\pageref{subsub:users-subjects}).

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id           & int(11)      & Identyfikator pliku\\
  subject\_id  & int(11)      & \\
  user\_id     & int(11)      & \\
  uploader\_id & int(11)      & \\
  filename     & varchar(255) & Nazwa pliku \\
  head         & varchar(255) & Tytuł pliku \\
  body         & text         & Opis pliku \\
  date         & datetime     & Data dodania \\
  kind         & varchar(15)  & Rodzaj \\
  downloads    & int(11)      & Ilość pobrań \\\hline
  \end{tabular}
  \caption{Tabela \emph{uploaded\_files}\label{tab:uploaded_files}}
\end{table}

Pole \emph{filename} (tab.~\ref{tab:uploaded_files}) zawiera tylko nazwę pliku -- system sam określi ścieżkę. Pole \emph{kind} określa rodzaj pliku. Możliwe są dwa stany:
\begin{itemize}
  \item \emph{material} -- plik z materiałami,
  \item \emph{grade} -- plik z ocenami.
\end{itemize}

\subsubsection{Tabela \emph{groups}}
\label{subsub:groups}
Tabela zawiera grupy użytkowników (tab~\ref{tab:groups}). Podstawowe typy grup to:
  \begin{itemize}
    \item Administratorzy,
    \item Zalogowani,
    \item Moduły (Elektronika, Telekomunikacja),
    \item Lata (Rok I -- Rok V),
    \item Grupy dziekanatowe (1 -- 10).
  \end{itemize}

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id       & int(11)      & Identyfikator grupy\\
  user\_id & int(11)      & \\
  head     & varchar(255) & Nazwa grupy \\
  body     & text         & Opis grupy \\\hline
  \end{tabular}
  \caption{Tabela \emph{groups}\label{tab:groups}}
\end{table}
 Każdy prowadzący może dodawać swoje grupy. Grupy pełnią istotną rolę przy określaniu uprawnień do plików. Dzięki nim możliwe jest dodawanie materiałów np. tylko dla III. roku albo tylko dla modułu Elektronika.

\newpage
\subsubsection{Tabela \emph{polls\_questions}}
\label{subsub:polls_questions}
Tabela (tab.~\ref{tab:polls_questions}) zawiera podstawowe informacje o każdej ankiecie.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id          & int(11)      & Identyfikator pytania\\
  user\_id    & int(11)      & \\
  question    & varchar(200) & Pytanie \\
  start\_time & datetime     & Czas rozpoczęcia \\
  end\_time   & datetime     & Czas zakończenia \\
  anonymous   & tinyint(1)   & Czy anonimowa? \\\hline

  \end{tabular}
  \caption{Tabela \emph{polls\_questions}\label{tab:polls_questions}}
\end{table}
\begin{itemize}
  \item Pole \emph{question} zawiera pytanie, jakie będzie zadane w ankiecie.
  \item Pole \emph{end\_time} określa czas zakończenia ankiety. Po jego upływie ankieta zostaje automatycznie zamknięta. Jeśli pozostanie puste, ankieta jest bezterminowa.
  \item Pole \emph{anonymous} informuje czy ankieta jest anonimowa. W systemie maksymalnie mogą być aktywne naraz dwie ankiety -- jedna anonimowa, druga nie.
\end{itemize}

\subsubsection{Tabela \emph{polls\_answers}}
\label{subsub:polls_answers}
Tabela (tab.~\ref{tab:polls_answers}) zawiera odpowiedzi do pytania zadanego w ankiecie. Jedna ankieta może mieć maksymalnie sześć odpowiedzi. Wynika to z ograniczenia systemu.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id          & int(11)      & Identyfikator odpowiedzi \\
  polls\_question\_id & int(11)      & \\
  answer              & varchar(200) & Odpowiedź \\
  quantity            & int(11)      & Ilość udzieleń \\\hline
  \end{tabular}
  \caption{Tabela \emph{polls\_answers}\label{tab:polls_answers}}
\end{table}

Pole \emph{quantity} zawiera ilość użytkowników którzy wybrali tą odpowiedź. Na podstawie tego pola później jest liczony procentowy udział tego wyboru.

\newpage

\subsubsection{Tabela \emph{exams\_names}}
\label{subsub:exams_names}
Tabela ta zawiera nazwy odpowiednich kombinacji typu studiów, roku i modułu przyporządkowane do ich kodu (tab.~\ref{tab:exams_names}).

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & varchar(3)   & Kod \\
  head & varchar(255) & Nazwa \\\hline
  \end{tabular}
  \caption{Tabela \emph{exams\_names}\label{tab:exams_names}}
\end{table}

 Pole \emph{id} wyjątkowo nie jest tu wartością liczbową, a kombinacją trzech znaków. Jest jednak jednoznacznie identyfikowalne i ma odnoszący się do niego klucz obcy w tabeli \emph{exams}.

\subsubsection{Tabela \emph{exams}}
\label{subsub:exams}
Tabela ta zawiera informacje o egzaminach w najbliższej sesji.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & int(11)   &  Identyfikator egzaminu\\
  subject\_id     & int(11)      & \\
  user\_id        & int(11)      & \\
  exams\_name\_id & varchar(3)   & \\
  examiner        & varchar(255) & Dane egzaminatora \\
  date            & datetime     & Data egzaminu \\
  place           & varchar(255) & Miejsce egzaminu \\
  term            & int(11)      & Termin \\\hline

  \end{tabular}
  \caption{Tabela \emph{exams}\label{tab:exams}}
\end{table}

\begin{itemize}
  \item Pole \emph{examiner} zawiera dane egzaminatora wpisane w postaci tekstu (tab.~\ref{tab:exams}), a nie referencję do odpowiedniego rekordu. Wynika to stąd, że czasami egzamin może przeprowadzać osoba spoza katedry.
  \item Pole \emph{term} określa termin egzaminu i powinno zawierać się w przedziale <0;3>.
\end{itemize}

\newpage
\subsubsection{Tabela \emph{events}}
\label{subsub:events}
Tabela ta zawiera kalendarz studenta (tab.~\ref{tab:events}).

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & int(11)   & Identyfikator wydarzenia\\
  beginning  & date         & Początek \\
  ending     & date         & Koniec \\
  head       & varchar(255) & Opis \\
  for\_year  & int(11)      & Dla których lat \\
  url        & varchar(255) & Link \\\hline
  \end{tabular}
  \caption{Tabela \emph{events}\label{tab:events}}
\end{table}

\begin{itemize}
  \item Pole \emph{for\_year} ma identyczne znaczenie jak to z tabeli \emph{news} (zob. rozdz.~\ref{subsub:news}, str.~\pageref{subsub:news}).
  \item Pole \emph{url} nie jest obowiązkowe. Jeśli jednak zostanie podane, to cały tytuł będzie linkiem do podanego w \emph{url} adresu.
\end{itemize}

\subsubsection{Tabela \emph{declarations}}
\label{subsub:declarations}
Tabela ta zawiera informacje konfiguracyjne deklaracji. Nie zawiera informacji o wyborach dokonanych przez studentów.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & int(11)   & Identyfikator deklaracji\\
  available\_from & date         & Dostępna od... \\
  available\_to   & date         & Dostępna do... \\
  code            & varchar(255) & Kod deklaracji \\
  head            & varchar(255) & Nazwa deklaracji \\
  year            & int(11)      & Dla którego roku \\
  how\_many       & int(11)      & Ile opcji \\\hline

  \end{tabular}
  \caption{Tabela \emph{declarations}\label{tab:declarations}}
\end{table}

\begin{itemize}
  \item Pola \emph{available\_from} i \emph{available\_to} określają przedział czasowy w którym dana deklaracja jest dostępna do wypełnienia (tab.~\ref{tab:declarations}). Rok nie jest brany pod uwagę.
  \item Pole \emph{year} określa, którego roku studiów taka deklaracja dotyczy. Jedna deklaracja jest przewidziana tylko dla jednego roku. Podobne deklaracje dla różnych lat, wymagają osobnych rekordów w bazie.
  \item Pole \emph{how\_many} dotyczy tylko deklaracji odnoszących się do wyboru przedmiotów obieralnych. Jest to liczba dwucyfrowa. Liczba dziesiątek oznacza liczbę przedmiotów do wybrania dla modułu Elektronika, jedności -- dla modułu Telekomunikacja.
\end{itemize}

\subsubsection{Tabela \emph{declarations\_subjects}}
\label{subsub:declarations_subjects}
Tabela (tab.~\ref{tab:declarations_subjects}) ta zawiera szczegółowe informacje o deklaracjach, a także informacje wypełniane przez studentów. Tabelę tę można dowolnie modyfikować. Więcej na ten temat zostało przedstawione w części Deklaracje (zob. rozdz.~\ref{sub:deklaracje}, str.~\pageref{sub:deklaracje}).

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & int(11)   & Identyfikator parametru deklaracji\\
  declaration\_id   & int(11)      & \\
  subject\_id       & int(11)      & \\
  user\_id          & int(11)      & \\
  price             & int(11)      & Cena materiałów \\
  name              & varchar(255) & Nazwa po angielsku \\
  grade             & decimal(2,1) & Ocena \\
  year              & int(11)      & Rok rozpoczęcia studiów \\
  speciality\_id    & int(11)      & Kierunek \\
  date              & date         & Data złożenia \\
  language          & varchar(4)   & Język przedmiotu \\
  print             & tinyint(1)   & Drukować materiały? \\
  study\_type       & varchar(1)   & Typ studiów \\
  study\_speciality & int(11)      & Specjalność \\\hline
  \end{tabular}
  \caption{Tabela \emph{declarations\_subjects}\label{tab:declarations_subjects}}
\end{table}

\begin{itemize}
  \item Pole \emph{price} dotyczy tylko druku materiałów. Oznacza ona cenę materiałów w złotówkach pomnożoną przez 10. Nie wypełniają go studenci.
  \item Pole \emph{name} dotyczy tylko deklaracji wyboru języka przedmiotów. Zawiera angielski odpowiednik nazwy przedmiotu. Nie wypełniają go studenci.
  \item Pole \emph{grade} dotyczy tylko deklaracji wyboru kierunku studiów. Oznacza ono ocenę z danego przedmiotu. Jest wypełniane przez studentów. Dodatkowo w modelu Rails jest metoda \emph{average}, która obliczą średnią ocen danego studenta.
  \item Pole \emph{year} dotyczy tylko deklaracji wyboru modułu studiów. Oznacza ono rok, w którym dany student rozpoczął studiowanie na Elektronice i Telekomunikacji. Jest wypełniane przez studentów.
  \item Pole \emph{speciality\_id} dotyczy tylko deklaracji wyboru modułu studiów. Zawiera \emph{id} kierunku (referencja do tabeli \emph{specialities}) na którym dany student chciałby kontynuuować swoją edukację. Jest wypełniane przez studentów.
  \item Pole \emph{date} dotyczy wszystkich deklaracji. Zawiera datę ich złożenia. Jest wypełniane przez system automatycznie.
  \item Pole \emph{language} dotyczy tylko deklaracji wyboru języka przedmiotów. Zawiera dwuliterowe kody języków wybrane przez studenta w formacie WWDD, gdzie WW to kod dla wykładu, a DD to kod dla zajęć dodatkowych (laboratoriów, ćwiczeń, itd.). Jest wypełniane przez studentów. Np. ENEN -- wszystko po angielsku, zaś opcja PLEN jest zabroniona.
  \item Pole \emph{print} dotyczy tylko deklaracji dotyczących druku materiałów. Jeśli jest ustawione na 1 oznacza, że dany student życzy sobie materiały w formie papierowej dla danego przedmiotu. Jest wypełniane przez studentów.
  \item Pole \emph{study\_type} dotyczy tylko deklaracji wyboru specjalności. Określa ono rodzaj studiów -- M to studia magisterskie, I to studia inżynierskie. Jest wypełniane przez studentów. Obecnie nieużywane.
  \item Pole \emph{study\_speciality} dotyczy tylko deklaracji wyboru specjalności. Zawiera ono cyfrowy kod specjalności. Jest wypełniane przez studentów.
\end{itemize}

\newpage
\subsubsection{Tabela \emph{declarations\_experiences}}
\label{subsub:declarations_experiences}
Tabela ta (tab.~\ref{tab:declarations_experiences}) zawiera szczegółowe informacje dotyczące praktyki zawodowej danego studenta.

\begin{table}[h]
  \centering
  \begin{tabular}{|c|c|l|}\hline
  Pole & Typ & Opis \\\hline
  id   & int(11)   & Identyfikator deklaracji praktyki\\
  declaration\_id       & int(11)      & \\
  firstname             & varchar(255) & Imię studenta \\
  lastname              & varchar(255) & Nazwisko studenta \\
  sindex                & int(6)       & Numer indeksu \\
  speciality\_id        & int(11)      & \\
  student\_street       & varchar(255) & Adres zamieszkania \\
  student\_postal\_code & varchar(255) & Kod pocztowy\\
  student\_city         & varchar(255) & Miasto \\
  place\_name           & varchar(255) & Miejsce praktyki \\
  place\_street         & varchar(255) & Adres zakładu pracy \\
  place\_postal\_code   & varchar(255) & Kod pocztowy\\
  place\_city           & varchar(255) & Miasto \\
  beginning             & date         & Termin rozpoczęcia \\
  beginning\_additional & date         & Dodatkowy termin \\
  ending\_additional    & date         & Koniec dodatkowego terminu \\
  dormitory             & tinyint(1)   & Czy chce akademik? \\
  policy\_type          & varchar(255) & Rodzaj ubezpieczenia \\
  policy\_name          & varchar(255) & Nazwa polisy \\
  policy\_number        & varchar(255) & Numer polisy \\
  confirmations         & int(11)      & Potwierdzenia \\
  created\_at           & datetime     & Utworzono \\
  updated\_at           & datetime     & Poprawiono \\\hline
  \end{tabular}
  \caption{Tabela \emph{declarations\_experiences}\label{tab:declarations_experiences}}
\end{table}

\begin{itemize}
  \item Pola \emph{student\_street}, \emph{student\_postal\_code}, \emph{student\_city} dotyczą adresu zameldowania studenta.
  \item Pola \emph{place\_name}, \emph{place\_street}, \emph{place\_postal\_code}, \emph{pace\_city} dotyczą informacji o zakładzie pracy, w którym będzie odbywać się praktyka.
  \item Pole \emph{beginning} to termin rozpoczęcia praktyki.
  \item Pola \emph{beginning\_additional} i \emph{ending\_additional} określają dodatkowy termin praktyki w przypadku gdyby praktyka była dwuetapowa.
  \item Pole \emph{dormitory} określa czy student jest zainteresowany pobytem w akademiku na czas praktyki.
  \item Pola \emph{policy\_type}, \emph{policy\_name} i \emph{policy\_number} dotyczą obowiązkowego dokumentu potwierdzającego ubezpieczenie na czas praktyki.

\begin{figure}[h]
  \centering
  \begin{tabular}{|c|c|c|c|c|}\hline
  E & D & C & B & A \\\hline
  \end{tabular}
  \begin{itemize}
    \item A -- dostarczone zaświadczenie z miejsca praktyki
    \item B -- dostarczona informacja o ubezpieczeniu
    \item C -- dostarczone potwierdzenie odbycia praktyki i sprawozdanie
    \item D -- praktyka bezpłatna
    \item E -- wpis do indeksu
  \end{itemize}
  \caption{Struktura pola \emph{confirmations}\label{fig:confirmations}}
\end{figure}

  \item Pole \emph{confirmations} zawiera potwierdzenia dla opiekuna praktyk (w formie maski bitowej), a jego struktura została przedstawiona na ryskunku \ref{fig:confirmations}.
\end{itemize}


\subsection{Opis relacji}
\label{sub:relacje}

W poprzednim rozdziale opisano wszystkie tabele. Są one połączone ze sobą za pomocą relacji przedstawionych w tej części.

\subsubsection{Relacja \emph{users}$\to$\emph{users\_students}}
\label{subsub:users-users_students}
\begin{itemize}
  \item Typ relacji: 1 do 1
  \item Pole: \emph{users\_students}.\emph{user\_id}
  \item Klucz obcy: \emph{users\_students\_ibfk\_1}
  \item Obowiązkowa
  \item Dodatkowe informacje o studencie, specyficzne tylko dla niego.
\end{itemize}

\subsubsection{Relacja \emph{specialities}$\to$\emph{users\_students}}
\label{subsub:specialities-users_students}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{users\_students}.\emph{speciality\_id}
  \item Klucz obcy: \emph{users\_students\_ibfk\_2}
  \item Obowiązkowa
  \item Informacje o module studiów studenta. Jeśli jeszcze nie został wybrany, pole przyjmuje wartość 1 (zob. tab.~\ref{subsub:specialities}, str.~\pageref{subsub:specialities}).
\end{itemize}

\subsubsection{Relacja \emph{cathedrals}$\to$\emph{users\_lecturers}}
\label{subsub:cathedrals-users_lecturers}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{users\_lecturers}.\emph{cathedral\_id}
  \item Klucz obcy: \emph{users\_lecturers\_ibfk\_1}
  \item Obowiązkowa
  \item Katedra do której dany prowadzący należy.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{users\_lecturers}}
\label{subsub:users-users_lecturers}
\begin{itemize}
  \item Typ relacji: 1 do 1
  \item Pole: \emph{users\_lecturers}.\emph{user\_id}
  \item Klucz obcy: \emph{users\_lecturers\_ibfk\_2}
  \item Obowiązkowa
  \item Dodatkowe informacje o prowadzącym, specyficzne tylko dla niego.
\end{itemize}

\subsubsection{Relacja \emph{subjects\_types}$\to$\emph{subjects}}
\label{subsub:subjects_types-subjects}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{subjects}.\emph{subjects\_type\_id}
  \item Klucz obcy: \emph{subjects\_ibfk\_1}
  \item Nieobowiązkowa
  \item Informacje o rodzaju danego przedmiotu.
\end{itemize}

\subsubsection{Relacja \emph{users}$\leftrightarrow$\emph{subjects}}
\label{subsub:users-subjects}
\begin{itemize}
  \item Typ relacji: wiele do wielu
  \item Pola: \emph{uploaded\_files}.\emph{user\_id}, \emph{uploaded\_files}.\emph{subject\_id}
  \item Tabela pośrednicząca: \emph{uploaded\_files}
  \item Klucze obce: \emph{uploaded\_files\_ibfk\_1}, \emph{uploaded\_files\_ibfk\_2}
  \item Obowiązkowa
  \item Relacja wykorzystywana do określenia, które przedmioty prowadzi dana osoba. Aby uniknąć z każdym semestrem ręcznego ich dodawania, wszystko dzieje automatycznie. Kryterium bycia prowadzącym jest dodanie pliku do systemu i przypisanie kogoś jako prowadzącego do określonego przedmiotu. Wtedy opis takiej osoby (oczywiście, jeśli dodatkowo jest wpisana do tabeli \emph{users\_lecturers}) automatycznie tworzy relację z tym przedmiotem poprzez tabelę \emph{uploaded\_files}, co system odczytuje również jako prowadzenie tychże zajęć.
\end{itemize}

\subsubsection{Relacja \emph{news\_types}$\to$\emph{news}}
\label{subsub:news_types-news}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{news}.\emph{news\_type\_id}
  \item Klucz obcy: \emph{news\_ibfk\_1}
  \item Nieobowiązkowa
  \item Informacje o rodzaju aktualności. Obecnie niewykorzystywane. Zachowane dla wstecznej zgodności i dla przyszłych zastosowań.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{news}}
\label{subsub:users-news}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{news}.\emph{user\_id}
  \item Klucz obcy: \emph{news\_ibfk\_2}
  \item Obowiązkowa
  \item Określa autora danej aktualności.
\end{itemize}

\subsubsection{Relacja \emph{subjects}$\to$\emph{news}}
\label{subsub:subjects-news}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{news}.\emph{subject\_id}
  \item Klucz obcy: \emph{news\_ibfk\_3}
  \item Nieobowiązkowa
  \item Określa przedmiot, którego dotyczy dana aktualność.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{uploaded\_files}}
\label{subsub:users-uploaded_files}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{uploaded\_files}.\emph{uploader\_id}
  \item Klucz obcy: \emph{uploaded\_files\_ibfk\_3}
  \item Obowiązkowa
  \item Informacja o tym kto dodał dany plik dla danego przedmiotu. Nie jest to jednoznaczne z byciem prowadzącym. Podczas dodawania pliku można określić, kto prowadzi dany przedmiot i może to być osoba inna od osoby dodającej plik.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{groups}}
\label{subsub:users-groups}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{groups}.\emph{user\_id}
  \item Klucz obcy: \emph{groups\_ibfk\_1}
  \item Nieobowiązkowa
  \item Informacja o założycielu danej grupy.
\end{itemize}

\subsubsection{Relacja \emph{groups}$\leftrightarrow$\emph{users}}
\label{subsub:groups-users}
\begin{itemize}
  \item Typ relacji: wiele do wielu
  \item Tabela pośrednicząca: \emph{groups\_users}
  \item Pola: \emph{groups\_users}.\emph{group\_id}, \emph{groups\_users}.\emph{user\_id}
  \item Klucze obce: \emph{groups\_users\_ibfk\_1}, \emph{groups\_users\_ibfk\_2}
  \item Obowiązkowa
  \item Informacje o przypisaniu użytkowników do grup.
\end{itemize}

\subsubsection{Relacja \emph{groups}$\leftrightarrow$\emph{news}}
\label{subsub:groups-news}
\begin{itemize}
  \item Typ relacji: wiele do wielu
  \item Tabela pośrednicząca: \emph{groups\_news}
  \item Pola: \emph{groups\_news}.\emph{group\_id}, \emph{groups\_news}.\emph{news\_id}
  \item Klucze obce: \emph{groups\_news\_ibfk\_1}, \emph{groups\_news\_ibfk\_2}
  \item Obowiązkowa
  \item Informacje o uprawnieniach do odczytu określonych wiadomości przez grupy. W poprzednim systemie funkcjonalność praktycznie nieużywana. W obecnym porzucona, zachowana tylko na poczet przyszłych ustaleń.
\end{itemize}

\subsubsection{Relacja \emph{groups}$\leftrightarrow$\emph{uploaded\_files}}
\label{subsub:groups-uploaded_files}
\begin{itemize}
  \item Typ relacji: wiele do wielu
  \item Tabela pośrednicząca: \emph{groups\_uploaded\_files}
  \item Pola: \emph{groups\_uploaded\_files}.\emph{group\_id}, \emph{groups\_uploaded\_files}.\emph{uploaded\_file\_id}
  \item Klucze obce: \emph{groups\_uploaded\_files\_ibfk\_1}, \emph{groups\_uploaded\_files\_ibfk\_2}
  \item Obowiązkowa
  \item Uprawnienia członków grup do określonych plików. Bardzo ważna funkcjonalność, która zabezpiecza np. materiały dla studentów określonego roku, przed ściągnięciem ich przez studentów innych lat, modułów czy innych grup.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{polls\_questions}}
\label{subsub:users-polls_questions}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{polls\_questions}.\emph{user\_id}
  \item Klucz obcy: \emph{polls\_questions\_ibfk\_1}
  \item Obowiązkowa
  \item Określa autora ankiety.
\end{itemize}

\subsubsection{Relacja \emph{polls\_questions}$\to$\emph{polls\_answers}}
\label{subsub:polls_questions-polls_answers}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{polls\_answers}.\emph{polls\_question\_id}
  \item Klucz obcy: \emph{polls\_answers\_ibfk\_1}
  \item Obowiązkowa
  \item Przypisuje daną odpowiedź do określonej ankiety.
\end{itemize}

\subsubsection{Relacja \emph{subjects}$\to$\emph{exams}}
\label{subsub:subjects-exams}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{exams}.\emph{subject\_id}
  \item Klucz obcy: \emph{exams\_ibfk\_1}
  \item Obowiązkowa
  \item Przedmiot z którego odbędzie się egzamin.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{exams}}
\label{subsub:users-exams}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{exams}.\emph{user\_id}
  \item Klucz obcy: \emph{exams\_ibfk\_2}
  \item Obowiązkowa
  \item Osoba, która dodała informację o egzaminie.
\end{itemize}

\subsubsection{Relacja \emph{exams\_names}$\to$\emph{exams}}
\label{subsub:exams_names-exams}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{exams}.\emph{exams\_name\_id}
  \item Klucz obcy: \emph{exams\_ibfk\_3}
  \item Obowiązkowa
  \item Specyficzna relacja, gdyż kluczem obcym nie jest tu liczba a trzyznakowy kod. Kod ten -- to kombinacja typu studiów, roku i modułu. Wszystkie egzaminy w systemie są pogrupowane wg. tych kodów, a ta relacja służy do rozwinięcia ich na pełną nazwę.
\end{itemize}

\subsubsection{Relacja \emph{declarations}$\to$\emph{declarations\_subjects}}
\label{subsub:declarations-declarations_subjects}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_subjects}.\emph{declaration\_id}
  \item Klucz obcy: \emph{declrations\_subjects\_ibfk\_1}
  \item Obowiązkowa
  \item Relacja przypisująca parametry, danej deklaracji.
\end{itemize}

\subsubsection{Relacja \emph{subjects}$\to$\emph{declarations\_subjects}}
\label{subsub:subjects-declarations_subjects}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_subjects}.\emph{subject\_id}
  \item Klucz obcy: \emph{declrations\_subjects\_ibfk\_2}
  \item Nieobowiązkowa
  \item Przedmiot, którego dotyczy dana deklaracja.
\end{itemize}

\subsubsection{Relacja \emph{users}$\to$\emph{declarations\_subjects}}
\label{subsub:users-declarations_subjects}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_subjects}.\emph{user\_id}
  \item Klucz obcy: \emph{declrations\_subjects\_ibfk\_3}
  \item Nieobowiązkowa
  \item Użytkownik, którego dotyczy deklaracja. Zawsze powinna być ustalona, jeśli student dodaje jakąś deklarację. Jest nieobowiązkowa tylko w przypadku, gdy wpis określa parametry samej deklaracji (zob. rozdz.~\ref{sub:deklaracje} str.~\pageref{sub:deklaracje})
\end{itemize}

\subsubsection{Relacja \emph{specialities}$\to$\emph{declarations\_subjects}}
\label{subsub:specialities-declarations_subjects}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_subjects}.\emph{speciality\_id}
  \item Klucz obcy: \emph{declrations\_subjects\_ibfk\_4}
  \item Nieobowiązkowa
  \item Określa moduł wybrany przez studenta. Istotna tylko dla deklaracji wyboru modułu.
\end{itemize}

\subsubsection{Relacja \emph{declarations}$\to$\emph{declarations\_experiences}}
\label{subsub:declarations-declarations_experiences}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_experiences}.\emph{declaration\_id}
  \item Klucz obcy: \emph{declrations\_experiences\_ibfk\_1}
  \item Obowiązkowa
  \item Relacja parametrów deklaracji praktyki, do określonej deklaracji praktyki.
\end{itemize}

\subsubsection{Relacja \emph{specialities}$\to$\emph{declarations\_experiences}}
\label{subsub:specialities-declarations_experiences}
\begin{itemize}
  \item Typ relacji: 1 do wielu
  \item Pole: \emph{declarations\_experiences}.\emph{speciality\_id}
  \item Klucz obcy: \emph{declrations\_experiences\_ibfk\_2}
  \item Obowiązkowa
  \item Moduł studiów studenta zgłaszającego się na praktykę.
\end{itemize}

\section{Konwersja bazy danych}
\label{sec:db-konwersja}
Najważniejszym problemem jaki należało rozwiązać była konwersja istniejącej bazy danych na format zgodny z Active~Record. Dodatkowym utrudnieniem był fakt, że dotychczasowa baza miała rozwiązane w różny sposób relacje -- raz były to klucze liczbowe, innym razem tekstowe. Dodatkowo nazwy kolumn często były mylące. Kolejnym problemem było kodowanie polskich znaków -- różnie rozwiązane w różnych tabelach.

Rozwiązaniem tych problemów jest specjalny konwerter. Został on zaprojektowany jako skrypt typu \emph{rake task}, który dokona automagicznie konwersji bez jakiejkolwiek ingerencji użytkownika. Jedyne co trzeba zrobić, to przygotować wcześniej specjalny plik konfiguracyjny \emph{config/convert\_map.yml}. Jest to plik formatu YAML (zob. rozdz.~\ref{sec:yaml}, str.\pageref{sec:yaml}), zawierający wszelkie wytyczne informujące konwerter jak ma przeprowadzić proces przeniesienia.

\subsection{Łączenie konwertera z bazami}
\label{sub:convert-base}
Do połączenia z bazami konwerter wykorzystuje standardowy plik konfiguracyjny w Ruby~on~Rails o nazwie \emph{config/database.yml} (rys.~\ref{fig:database-yml}). 
\begin{figure}[h]
\centering
\begin{verbatim}original:
  adapter: mysql
  database: eit_old
  username: eit
  password: haslo
  encoding: latin2
converted:
  adapter: mysql
  database: eit_new
  username: eit
  password: haslo
  encoding: utf8\end{verbatim}
\caption{Przykładowe wpisy konwertera w pliku \emph{config/database.yml}\label{fig:database-yml}}
\end{figure}
Należy zdefiniować dwie nowe reguły \emph{original} (dotyczącą połączenia ze starą bazą) i \emph{converted} (połączenie do nowej bazy). Bardzo ważne jest, aby pamiętać o określeniu typu kodowania. Jeśli kodowanie w \emph{original} i \emph{converted} będą się różnić aplikacja sama zrzutuje jeden standard znaków na drugi. Dlatego należy przypilnować, aby w systemie była zainstalowana biblioteka \emph{iconv}, który odpowiada właśnie za to rzutowanie.

\subsection{Plik konfiguracyjny konwersji}
\label{sub:convert-conf}

Struktura pliku konfiguracyjnego konwersji (wraz z przykładem) jest przedstawiona na rys.~\ref{fig:convert_map} i rys~\ref{fig:convert_map-ex}.
\begin{figure}[h]
\centering
\begin{verbatim}<liczba porządkowa>_<nowa nazwa tabeli>:
  <stara nazwa tabeli>:
    <... opcje tabeli ...>
    <stara nazwa kolumny>:
      <... opcje kolumny ...>
    <kolejna stara kolumna>:
      <... opcje kolumny ...>
<liczba porządkowa>_<kolejna tabela>:
  <... itd. ...>\end{verbatim}
\caption{Struktura pliku \emph{config/convert\_map.yml}\label{fig:convert_map}}
\end{figure}

\begin{figure}[h]
\centering
\begin{verbatim}03_users_students:
  users_k1:
    __BEFORE: INSERT INTO @ (id) SELECT id FROM users WHERE id NOT IN (SELECT id FROM users_k1) AND id NOT IN (SELECT id from users_k2) AN
D login IS NOT NULL AND kind = 1
    __AFTER: ALTER TABLE users_k1 DROP band2
    id:
      from: users
      name: user_id
    band:
      name: sgroup
    band2:
      name: speciality_id
      function: IF((SELECT (SUBSTRING(NOW(),1,4) - CONCAT('20', SUBSTRING(@, 2,2))) > 2),IF((SELECT SUBSTRING(@, 4,1)) > 3,2,3),1)
    indeks:
      name: sindex
    gg:
      name: gadu_gadu
    module:
      action: remove
    modified:
      action: remove
    nband:
      action: remove\end{verbatim}
\caption{Fragment pliku \emph{config/convert\_map.yml}\label{fig:convert_map-ex}}
\end{figure}

Opcje w pliku można podzielić na dwie grupy -- opcje tabeli i opcje kolumny. Opcje tabeli to:
\begin{itemize}
  \item \emph{\_\_BEFORE} -- określa zapytanie SQL, które ma zostać wykonane przed rozpoczęciem konwersji na starej tabeli. Jest to użyteczne, gdy trzeba wcześniej poprawić jakieś niespójne dane, aby później ułatwić w ten sposób pracę konwerterowi. Znak ,,@'' (at) przy składaniu zapytania zostanie zamieniony na nazwę starej tabeli.
  \item \emph{\_\_AFTER} -- analogicznie jak powyżej, tylko zapytanie zostanie wykonane po konwersji. Zazwyczaj używane do odwrócenia zmian wykonanych w \emph{\_\_BEFORE}, aby pozostawić starą bazę danych w nienaruszonym stanie.
  \item \emph{\_\_WHERE} -- ta opcja spowoduje dodanie klauzuli \emph{WHERE} do zapytania wyciągającego dane ze starej tabeli. Dzięki temu konwersji mogą zostać poddane tylko określone wiersze (ponieważ np. pozostałe są już przestarzałe i nie ma dla nich miejsca w nowej bazie, albo chcemy rozbić konwersję na kilka etapów i każdy z nich przeprowadzić osobno).
\end{itemize}

Opcje kolumn stanowią:
\begin{itemize}
  \item \emph{action} -- akcja, jaką należy podjąć na tej kolumnie. Dostępne są dwie akcje: \emph{copy} i \emph{remove}. Pierwsza kopiuje dane z kolumny do nowej tabeli, druga nie bierze pod uwagę tej kolumny przy konwersji. Domyślna akacja to \emph{copy}.
  \item \emph{name} -- nowa nazwa kolumny. Domyślnie kopiowana jest stara.
  \item \emph{from} -- definicja funkcji mappera wartości. Często zdarza się tak, że przy kopiowaniu starych tabel na nowe niektóre wartości nie spełniają kryteriów nowej bazy danych i są odrzucane. Skutkiem tego zmienia się ułożenie wierszy w tabeli, a co za tym idzie, także wartości pól \emph{id}. Podczas pracy konwertera, równolegle działa również specjalny kod mapujący, który odwzorowuje stary numer \emph{id} na nowy. Dzięki temu zachowane zostają relacje i spójność bazy danych. Opcja \emph{from} określa, mapa której tabeli ma zostać wykorzystana przy konwersji obcych \emph{id}. Na przykład, przenoszona jest tabelka \emph{users} i zniknęło kilkudziesięciu użytkowników. Zmieniły się więc numery \emph{id} użytkowników bezpośrednio po nich. Teraz następuje przenoszenie tabelki \emph{users\_students}, która ma jednak referencję do tabelki \emph{users}. Gdyby nie zastosowano mapowania, referowane \emph{user\_id} przeniosłyby się tak jak były, skutkiem czego wskazywałyby na zupełnie innych użytkowników. Ważna uwaga -- parametr \emph{from} jako nazwę mapy ustawia sobie nazwę nowej tabeli. Jeśli więc przenosiliśmy np. tabelkę \emph{specs} na \emph{subjects}, to mapa będzie miała nazwę \emph{subjects} i taką należy podać.
  \item \emph{field} -- polecenie określające po jakim polu odbywa się mapowanie. Domyślnie jest to \emph{id} i w większości przypadków nie należy tego zmieniać.
  \item \emph{function} -- funkcja SQL, której działaniu zostanie poddana nowa wartość zanim zostanie wpisana do nowej tabeli. Samą daną reprezentuje ,,@'' (at). Na przykład, \emph{function: SHA1(@)} spowoduje, że wszystkie dane z tej kolumny będą poddawane haszowaniu SHA1, zanim zostaną wpisane do nowej bazy.
  \item \emph{connect} -- służy do łączenia wartości kilku kolumn w starej tabeli w jedną w nowej. Nazwy kolumn należy oddzielić przecinkiem, np. \emph{"dt\_year, dt\_month, dt\_day, dt\_hour, dt\_min"}
  \item \emph{pattern} -- wymagane razem z connect. Określa schemat połączenia kolumn. Np. \emph{"\{dt\_year\}-\{dt\_month\}-\{dt\_day\} \{dt\_hour\}:\{dt\_min\}"} stworzy z pięciu kolumn reprezentujących datę, jedną zgodną z formatem DATETIME.
\end{itemize}

\subsection{Uruchamianie konwertera}
\label{sub:conv-run}

Przed rozpoczęciem konwersji warto wcześniej wyczyścić nową bazę danych (jeżeli dokonujemy zmian). Konwerter uruchamia się, wpisując w głównym katalogu aplikacji polecenie przedstawione na rys.~\ref{fig:raketask}
\begin{figure}
\centering
\begin{verbatim}$ rake eit:db:convert\end{verbatim}
\caption{Polecenie wykonujące konwersję baz danych\label{fig:raketask}}
\end{figure}
Wszystkie błędy w czasie działania konwertera są zapisywane w pliku \emph{log/conversion.log}. Wpisy w nim niekoniecznie oznaczają, że coś poszło w sposób nieplanowany. Informują one o tym, które wiersze nie zostały przeniesione do nowej bazy -- zazwyczaj powodem jest nie spełnianie one nowych kryteriów (np. w nowej tabeli kolumna ma atrybut \emph{NOT NULL} skutkiem czego wszystkie dane, które były \emph{NULL} nie zostaną przeniesione). Po automatycznej konwersji powinna być zatem wykonana dodatkowa praca, sprawdzenia odrzuconych rekordów i przenoszenia ich w razie potrzeby.

\section{Mapa serwisu}
\label{sec:mapa}
Kolejnym krokiem było zbudowanie mapy serwisu. Bardzo ważne jest, aby na etapie projektu mapy zaprojektować także adresy URL. Użytkownicy używają ich na różne sposoby. Wysyłają je do innych osób poprzez e-mail, publikują je na forach internetowych, dyktują przez telefon. Najczęściej nie są to adresy strony głównej, ale adresy podstrony. Warto więc zadbać aby adres był krótki i opisowy, ułatwi to w znaczny sposób korzystanie z serwisu. Na rysunku \ref{fig:eitmap} przedstawiono zastosowany schemat mapy strony. Znajdują się tu tytuły stron wraz z odpowiadającymi im ścieżkami.

\newpage
\thispagestyle{empty}
\addtolength{\textwidth}{4cm}
\addtolength{\hoffset}{-2.5cm}
\addtolength{\textheight}{5cm}
\addtolength{\voffset}{-3.5cm}
\begin{landscape}
\begin{figure}
\centering
%  \includegraphics{mapa_eit.png}
  \caption{
  Mapa strony kierunku Elektronika i Telekomunikacja.
  \label{fig:eitmap}
  }
\end{figure}
\end{landscape}
\newpage
\addtolength{\textwidth}{-4cm}
\addtolength{\hoffset}{2.5cm}
\addtolength{\textheight}{-5cm}
\addtolength{\voffset}{3.5cm}



\section{Opis poszczególnych kontrolerów i akcji}
\label{sec:kontrolery}

W tej części pracy opisano kontrolery systemu MVC wraz z przypisanymi im akcjami.

\subsection{\emph{IndexController}}
\label{con:index}
  Główny kontroler, uruchamiany przy pierwszym wejściu na stronę. Zawiera tylko jedną akcję -- \emph{index}.
\begin{itemize}
  \item \emph{index} -- akcja odpowiedzialna za wyświetlanie pierwszej, ,,powitalnej'' strony EiT. Ładuje siedem ostatnich aktualności, siedem ostatnio dodanych materiałów, ostatnie ankiety oraz ostatnio dodane oceny. 
\end{itemize}

\subsection{\emph{AboutController}}
\label{con:about}
  Kontroler wyświetlający informacje o samej stronie EiT i osobach, które ją tworzyły.
\begin{itemize}
  \item \emph{index} -- rys historyczny powstawania strony Elektroniki i Telekomunikacji,
  \item \emph{eiteam} -- zespół odpowiedzialny za stronę,
  \item \emph{map} -- mapa serwisu,
  \item \emph{faq} -- najczęściej zadawane pytania odnośnie witryny.
\end{itemize}

\subsection{\emph{CsvController}}
\label{con:csv}
  Kontroler odpowiedzialny za generowanie plików \emph{.csv} i wysyłanie ich użytkownikom. Głównie stosowany przy podsumowaniach deklaracji. Każda akcja wysyła określony plik csv.
\begin{itemize}
  \item \emph{language} -- informacje o językach prowadzenia przedmiotów, wybranych przez poszczególnych studentów,
  \item \emph{print} -- informacje o zainteresowaniu wydrukiem materiałów,
  \item \emph{module} -- kto wybrał jaki moduł,
  \item \emph{subjects} -- przypisanie studentów, do poszczególnych przedmiotów obieralnych,
  \item \emph{experience} -- zbiorcze deklaracje praktyk,
  \item \emph{speciality} -- informacje o wyborze kierunku studiów i specjalności.
\end{itemize}

\subsection{\emph{DeaneryController}}
\label{con:deanery}
  Kontroler odpowiedzialny za wyświetlanie informacji z dziekanatu.
\begin{itemize}
  \item \emph{index} -- wyświetla podstawowe informacje o osobach pracujących w dziekanacie i godzinach przyjęć,
  \item \emph{skeds} -- lista planów zajęć do pobrania, w formacie XLS,
  \item \emph{experience} -- informacje dotyczące praktyk zawodowych na III. i IV. roku,
  \item \emph{subjects} -- lista wszystkich przedmiotów z podziałem na lata, kierunki, moduły i specjalności,
  \item \emph{eligible} -- lista przedmiotów obieralnych dla poszczególnych modułów i semestrów, wraz z liczbą studentów, którzy je wybrali,
  \item \emph{english} -- informacje o przedmiotach prowadzonych w języku angielskim,
  \item \emph{iep} -- informacje o międzynarodowym programie edukacyjnym,
  \item \emph{declarations} -- sekcja wymagająca zalogowania się, dostępna tylko dla studentów. Umożliwia wypełnienie wszystkich aktualnie dostępnych deklaracji, a także zawiera informacje na ich temat. Więcej informacji w sekcji ,,Deklaracje'' rozdz.~\ref{sub:deklaracje}, str.~\pageref{sub:deklaracje},
  \item \emph{calendar} -- kalendarz studenta. Wszystkie istotne wydarzenia z jego punktu widzenia (sesje, ferie, terminy składania podań, itd.).
\end{itemize}

\subsection{\emph{FileController}}
\label{con:file}
  Kontroler odpowiedzialny za pobieranie plików z serwisu.
\begin{itemize}
  \item \emph{download} -- zgodnie z polityką bezpieczeństwa, wszystkie pliki dodawane przez użytkowników nie są trzymane w katalogu widocznym z poziomu serwera WWW. Wynika to stąd, że wtedy każdy mógłby podać bezpośredniego linka do takiego pliku i cały mechanizm logowania i zabezpieczania materiałów byłby niepotrzebny. Zamiast tego pliki leżą w specjalnym katalogu (tu \emph{/files}) i są przetwarzane przez skrypt. Polega to na sprawdzeniu czy plik istnieje oraz czy użytkownik, który się do niego odwołuje ma do niego prawa dostępu. Jeśli tak, następuje pobranie, jeśli nie, strona zwraca błąd braku uprawnień.
\end{itemize}

\subsection{\emph{LecturersController}}
\label{con:lecturers}
  Kontroler wyświetlający informacje o wszystkich prowadzących dopisanych do systemu.
\begin{itemize}
  \item \emph{index} -- wyświetla listę wszystkich prowadzących, wraz z linkami do ich profili.
  \item \emph{electronics} -- j.w., ale tylko prowadzący z Katedry Elektroniki
  \item \emph{telecommunication} -- j.w., ale tylko prowadzący z Katedry Telekomunikacji
\end{itemize}

\subsection{\emph{MaterialsController}}
\label{con:materials}
  Kontroler odpowiedzialny za wyświetlanie i wyszukiwanie materiałów oraz ocen dodanych do serwisu.
\begin{itemize}
  \item \emph{index} -- wyświetla 10 ostatnich materiałów oraz stanowi punkt wyjścia przy wyszukiwaniu kolejnych. Kiedy użytkownik wypełni pola i uruchomi wyszukiwanie, akcja ta pobiera zapytanie POST z formularza i przetwarza je na zapytanie GET. W takiej postaci przesyłane jest ono do akcji \emph{search}. Całe to przetwarzanie zrobione jest w celu podawania zapytania do wyszukiwarki bezpośrednio w postaci linków -- w wielu miejscach są np. linki do materiałów konkretnego prowadzącego, które nie są niczym innym, jak odpowiednio przygotowanym zapytaniem dla akcji \emph{search},
  \item \emph{search} -- pobiera zapytanie, złożone z pięciu kryteriów oddzielonych przecinkami. Są to kolejno:
  \begin{itemize}
    \item zakodowane ID przedmiotu,
    \item zakodowane ID prowadzącego,
    \item numer semestru,
    \item treść wyszukiwania,
    \item rodzaj sortowania wyników.
  \end{itemize}
  W przypadku braku którejkolwiek z wartości nie jest ona brana pod uwagę przy wyszukiwaniu,
  \item \emph{grades} -- dostępne tylko dla zalogowanych użytkowników listy ocen. Kryterium wyszukiwania jest grupa -- jeśli użytkownik i plik z oceną należą do tej samej, to link do pliku jest wyświetlany.
\end{itemize}

\subsection{\emph{NewsController}}
\label{con:news}
  Kontroler odpowiadający za wyświetlanie aktualności.
\begin{itemize}
  \item \emph{index} -- akcja wyświetlająca wszystkie aktualności (stronami po 10) a także robiąca za pośrednika dla wyszukiwarki (patrz niżej),
  \item \emph{search} -- wyszukiwarka aktualności. Przyjmuje parametry rozdzielone przecinkami, metodą GET. W przypadku ich braku wyświetla formularz. Mechanizm działania jest następujący -- użytkownik wpisuje szukaną informacje i określa kryteria wyszukiwania; następnie całość jest składana w zapytanie typu POST i zostaje przekierowane do akcji \emph{index}; akcja \emph{index} rozpakowuje zapytanie, buduje odpowiednie żądanie GET dla akcji \emph{search}, a następnie go do niej wysyła; akcja \emph{search} wyświetla posegregowane wyniki wyszukiwania (stronami po 10),
  \item \emph{read} -- akcja, która jako parametr przyjmuje zakodowane ID wiadomości (zob. rozdz.~\ref{sub:idencoder}, str.~\pageref{sub:idencoder}), odkodowuje je, a następnie wyświetla aktualność zgodną z tym numerem,
  \item \emph{exams} -- akcja wyświetlająca informacje o egzaminach w aktualnej sesji. Dodatkowo, jeżeli użytkownik posiada stosowne uprawnienia, umożliwia dodawanie, edycję i usuwanie egzaminów. 
\end{itemize}

\subsection{\emph{PostgraduateController}}
\label{con:postgraduate}
  Kontroler odpowiadający za wyświetlanie informacji na temat studiów podyplomowych.
\begin{itemize}
  \item \emph{index} -- ulotka reklamowa,
  \item \emph{regulations} -- regulamin,
  \item \emph{schedule} -- harmonogram,
  \item \emph{program} -- program,
  \item \emph{sked} -- plan zajęć.
\end{itemize}

\subsection{\emph{ProfileController}}
\label{con:profile}
  Kontroler odpowiedzialny za wyświetlanie informacji o użytkownikach.
\begin{itemize}
  \item \emph{view} -- wyświetla informacje o użytkowniku, którego zakodowane ID przyjmuje jako parametr. Zalogowany użytkownik może wyświetlić informacje o każdym, niezalogowany -- tylko o prowadzących.
\end{itemize}

\subsection{\emph{RedirectController}}
\label{con:redirect}
  Kontroler odpowiedzialny za odpowiednie przekierowywanie ze starych linków na nowe (zob. rozdz.~\ref{sec:mapa-linkow}, str.~\pageref{sec:mapa-linkow})
\begin{itemize}
  \item \emph{index} -- przekierowuje na adres podany w parametrze
\end{itemize}

\subsection{\emph{RegisterController}}
\label{con:register}
Kontroler odpowiedzialny za rejestrację. Cały mechanizm rejestracji jest dość specyficzny, z racji tego, że nie każdy może dołączyć do serwisu. Dopisać się mogą tylko osoby znajdujące się na liście studentów corocznie dostarczanej przez dziekanat. Takie osoby są dopisywane do bazy bez przydzielonego loginu i hasła. Proces rejestracji polega więc, wpierw na uwierzytelnieniu się swoim imieniem, nazwiskiem i numerem indeksu, a następnie na podaniu pozostałych informacji o sobie. Po pomyślnym przejściu procesu student staje się użytkownikiem systemu.
\begin{itemize}
  \item \emph{index} -- przeprowadzenie procesu rejestracji, tylko dla niezalogowanych użytkowników.
\end{itemize}

\subsection{\emph{RssController}}
\label{con:rss}
  Kontroler generujący treść dla czytników RSS (zob. rozdz.~\ref{sec:rss}, str.~\pageref{sec:rss}).

\begin{itemize}
  \item \emph{index} -- zwraca 15 ostatnich aktualności w formacie zgodnym z RSS.
\end{itemize}

\subsection{\emph{RtfController}}
\label{con:rtf}
  Kontroler stworzony w celu serwowania predefiniowanych, dynamicznie uzupełnianych dokumentów \emph{.rtf}.
\begin{itemize}
  \item \emph{experience} -- wysyła użytkownikowi (oczywiście, jeśli ma odpowiednie uprawnienia) komplet gotowych umów o praktykę między studentami (którzy wypełnili deklaracje praktyk) a ich zakładami pracy.
\end{itemize}

\subsection{\emph{SettingsController}}
\label{con:settings}
  Kontroler zbiorczy, odpowiedzialny za wszystkie zadania związane z administracją serwisu.
\begin{itemize}
  \item \emph{index} -- wyświetlenie strony powitalnej zawierającej odnośniki do wszystkich sekcji administracyjnych wraz z określeniem praw dostępu (zielona kropka -- dostęp dozwolony, czerwona -- zabroniony),
  \item \emph{news} -- administracja aktualnościami,
  \item \emph{materials} -- dodawanie materiałów oraz ustalanie do nich praw dostępu,
  \item \emph{grades} -- j.w. dla ocen,
  \item \emph{groups} -- administrowanie grupami studentów; nie można zmienić domyślnie zadeklarowanych, można jednak dodawać, usuwać i edytować swoje,
  \item \emph{polls} -- dodawanie ankiet,
  \item \emph{declarations} -- wyświetlenie informacji o deklaracjach wypełnionych przez studentów oraz zarządzanie nimi (zob. rozdz.~\ref{sub:deklaracje}, str.~\pageref{sub:deklaracje},
  \item \emph{calendar} -- zarządzanie kalendarzem studenta,
  \item \emph{profile} -- zarządzanie profilem aktualnie zalogowanego użytkownika. Z poziomu tej akcji, można zmienić swój login, hasło i kilka innych danych.
\end{itemize}

\subsection{\emph{SigninController}}
\label{con:signin}
  Kontroler obsługujący wszelkie akcje związane z logowaniem użytkownika do systemu.
\begin{itemize}
  \item \emph{index} -- akcja odpowiadająca za logowanie użytkownika,
  \item \emph{signout} -- wylogowuje zalogowanego,
  \item \emph{remindme} -- uruchamia procedure odzyskania zapomnianego hasła. Wpierw użytkownik proszony jest o podanie imienia, nazwiska i numeru indeksu. Jeżeli dane te zostaną pomyślnie zweryfikowane użytkownikowi wyświetlone jest pytanie kontrolne. Odpowiedź na nie jest przekierowywana do akcji \emph{answer}. W przypadku, kiedy użytkownik nie zadeklarował pytania ratunkowego wyświetlana jest stosowna informacja,
  \item \emph{answer} -- ta akcja sprawdza odpowiedź podaną przez użytkownika na pytanie kontrolne. Jeśli jest poprawna, następuje zalogowanie do systemu.
\end{itemize}

\subsection{\emph{StudentsController}}
\label{con:students}
  Kontroler zawierający wszelkie informacje dotyczące samych studentów.
\begin{itemize}
  \item \emph{index} -- wyszukiwarka studentów, dostępna tylko dla zalogowanych użytkowników. Pozwala na wybór kryteriów wyszukiwania, wpływ na wyświetlane wyniki i określenie kolumny po której odbędzie się końcowe sortowanie. Całe zapytanie POST z formularza jest przesyłane do akcji \emph{results},
  \item \emph{results} -- przetwarza zapytanie POST z wyszukiwarki i wyświetla pasujące do kryteriów wyszukiwania wyniki -- odpowiednio posortowane i opisane,
  \item \emph{own\_webpage} -- informacje dla studentów chcących sobie założyć własną stronę WWW na serwerach EiT,
  \item \emph{webpages} -- lista wszystkich stron WWW na serwerze EiT. Lista jest tworzona poprzez przeszukanie wszystkich katalogów domowych użytkowników pod kątem katalogu \emph{public\_html}. Wszyscy, którzy mają taki katalog a ich loginy zgadzają się z loginami w bazie zostają wyświetleni. Dodatkowo, w rubryce ,,Opis strony domowej'' pojawia się zawartość pliku \emph{.webinfo} znajdującego się w katalogu ze stroną (o ile taki plik istnieje).
\end{itemize}

\subsection{\emph{SubjectController}}
\label{con:subject}
  Kontroler wyświetlający informacje o przedmiocie.
\begin{itemize}
  \item \emph{method\_missing} -- jest to specjalna metoda w Rubym. Jest ona zawsze wywoływana, gdy obiekt próbuje odwołać się do nieistniejącej metody. Jako pierwszy parametr przyjmuje jej nazwę. W tym przypadku, nazwa ta jest interpretowana jako akronim nazwy przedmiotu i jeśli zostanie odnaleziony w bazie, wszelkie informacje na temat tych zajęć są wyświetlane użytkownikowi.
\end{itemize}

\section{Komponenty}
\label{sec:components}
Do poprawnego działania aplikacji, niezbędne okazało się stworzenie kilku komponentów -- małych klas, stworzonych w jednym, określonym celu. Dzięki temu, zgodnie z regułą DRY (zob. rozdz.~\ref{sec:dry}, str.~\pageref{sec:dry}) pomocne procedury biblioteczne są zaimplementowane jednokrotnie.
\subsection{IdEncoder}
\label{sub:idencoder}
  IdEncoder to klasa krytyczna z punktu widzenia bezpieczeństwa aplikacji. Jej zadaniem jest kodowanie cyfr (zazwyczaj numerów \emph{id} wierszy, stąd nazwa \emph{IdEncoder}) na trudny do złamania ciąg znaków. Głównym celem takiego postępowania jest zabezpieczenie się przed wszelkiego rodzaju botami, które chodząc po stronie mogłyby inkrementować liczniki co 1 i w ten sposób powyciągać wszystkie informacje z bazy. Dodatkowo zabezpiecza to przed sprytnymi użytkownikami, którzy mając dostęp do materiału o \emph{id} np. 3, a nie mając do 4, próbowaliby podmieniać cyfry w adresach URL. Po instalacji aplikacji należy w klasie IdEncoder ustawić dwie zmienne:
\begin{itemize}
  \item \emph{hash} -- jest to liczba z zakresu <0;4294967295>, z którą \emph{id} będzie poddane opearacji XOR na początku kodowania,
  \item \emph{salt} -- jest to dwudziestocyfrowa liczba, z której 10 cyfr będzie użyte do zaciemnienia wyniku w końcowym etapie kodowania.
\end{itemize}
Schemat kodowania jest przedstawiono we wzorach \ref{equ:xor}~---~\ref{equ:idenc}.
\begin{equation}
  id_{XOR} = id \oplus hash
  \label{equ:xor}
\end{equation}
\begin{equation}
  salt_{M} = salt_{MARKER} = id_{XOR}~mod~10
  \label{equ:salt}
\end{equation}
\begin{equation}
  id_{ENC} = \left(\frac{salt~mod~10^{20 - salt_{M}} - salt~mod~10^{20 - salt_{M} - 10}}{10^{20 - salt_{M} - 10}} * 10 + salt_{M}\right)_{(28)}
  \label{equ:idenc}
\end{equation}
Liczba (28) we wzorze~\ref{equ:idenc}, oznacz konwersję wyniku na format dwudziestoósemkowy -- dzięki czemu otrzymujemy w zakodowanym \emph{id} zestaw liter i cyft. Rozkodowywanie odbywa się symetrycznie. 

Dodatkowo, algorytm został tak pomyślany, że nawet znając schemat postępowania niemożliwe jest rozkodowanie liczby bez znajomości \emph{hash} i \emph{salt}.

Użycie klasy jest bardzo proste i zostało zilustrowane na rys.~\ref{fig:idenc}.
\begin{figure}[h]
\begin{verbatim}IdEncoder.encode(id)         # zakoduj id
IdEncoder.decode(encoded_id) # zdekoduj id\end{verbatim}
\caption{Użycie polecenia IdEncoder\label{fig:idenc}}
\end{figure}

\subsection{Pager}
\label{sub:pager}
Klasa \emph{Pager} jest wykorzystywana wszędzie tam, gdzie zwracana liczba wyników jest zbyt duża i umieszczenie ich na jednej stronie znacznie zmniejszyłoby czytelność, lub wręcz ją uniemożliwiło (wygenerowana strona byłaby tak duża, że ściągnięcie jej zajęłoby zbyt dużo czasu). Budowa konstruktora jest następująca:

\begin{figure}[h]
\begin{verbatim}def initialize params, results, params_key = :id, actual_page = nil,
               results_per_page = 10
  ...
end\end{verbatim}
\caption{Struktura konstruktora klasy Pager\label{fig:page}}
\end{figure}


Gdzie parametry to:
\begin{itemize}
  \item \emph{params} -- tablica params z kontrolera. Z racji tego, że komponenty są oddzielone od warstwy aplikacji, nie mają dostępu do domyślnych tablic Ruby~on~Rails (m.in. params), dlatego należy je przekazać. Jest to konieczne, aby w klasie Pager można było poprawnie budować odnośniki.
  \item \emph{results} -- zawiera obiekt modelu danych wyciągniętych bezpośrednio z bazy, które mają być podzielone na strony.
  \item \emph{params\_key} -- domyślnie \emph{:id}. Określa który parametr rutera Rails ma być interpretowany jako numer kolejnej strony z wynikami (czasami zdarza się, że \emph{:id} jest już wykorzystane do czegoś innego, wtedy ta opcja się przydaje).
  \item \emph{actual\_page} -- wymuszenie zwrócenia wyników dla określonej strony. Domyślnie brana jest strona z \emph{params[params\_key]} (lub pierwsza, jeśli podana wartość jest błędna lub nieistniejąca).
  \item \emph{results\_per\_page} -- określa ile wyników ma być zareprezentowanych na jednej stronie. Domyślnie jest to 10.
\end{itemize}
Dodatkowo Pager zawiera wiele przydatnych metod, użytecznych przy budowaniu widoków. Są to:
\begin{itemize}
  \item \emph{count} -- zwraca liczbę stron,
  \item \emph{array\_of\_pages} -- zwraca pasek nawigacyjny klasy Pager. Są to cyfry z numerami stron i strzałkami ,,poprzednia'', ,,następna'' itd. (zobacz rysunek \ref{fig:array_of_pages}, gdzie \emph{page\_number} = 100, a \emph{pages\_padding} = 3. Dodatkowo na górze po lewej, efekt działania \emph{results\_range} z domyślnym separatorem.). 

\begin{figure}[h]
\centering
\includegraphics{array_of_pages.png}
\caption{Przykład wykorzystania \emph{array\_of\_pages}. \label{fig:array_of_pages}}
\end{figure}

Przyjmuje dwa parametry:
  \begin{itemize}
    \item \emph{page\_number} -- względem której strony ma być wyskalowany. Domyślnie jest to aktualna strona.
    \item \emph{pages\_padding} -- odnośniki do ilu stron wokół aktywnej mają zostać wyświetlone. Domyślnie trzy.
  \end{itemize}
  \item \emph{last\_page} -- zwraca numer ostatniej strony,
  \item \emph{results} -- zwraca wyniki w zakresie odpowiednim dla aktualnej strony,
  \item \emph{all\_results} -- zwraca wszystkie wyniki (czyli tak naprawdę obiekt \emph{results} przekazany do konstruktora),
  \item \emph{results\_count} -- zwraca liczbę wszystkich wyników,
  \item \emph{results\_range} -- zwraca pełny zakres dostępnych stron oddzielonych separatorem przekazanym jako parametr. Czyli np. ,,1 - 123'', zobacz rysunek \ref{fig:array_of_pages},
  \item \emph{actual\_page} -- zwraca numer aktualnej strony,
  \item \emph{next\_page} -- zwraca numer następnej strony,
  \item \emph{previous\_page} -- zwraca numer poprzedniej strony.
\end{itemize}
Dodatkowo klasa Pager ma przygotowany, predefiniowany dla serwisu EiT widok wyświetlający nawigację, który można znaleźć w \emph{app/views/\_partials/\_pager.rhtml} (zob. rozdz.~\ref{subsec:mvc-ror}, str.~\pageref{subsec:mvc-ror}).

\subsection{Imieniny}
\label{sub:nameday}
Klasa \emph{NameDay} to bardzo prosta, statyczna klasa o jednej metodzie -- \emph{get}. Przyjmuje ona dwa parametry: dzień i miesiąc, a następnie zwraca gotowy łancuch znaków zawierający oddzielone przecinkiem imieniny osób w tym dniu.

\subsection{Deklaracje}
\label{sub:deklaracje}
System deklaracji to najbardziej dynamiczna część serwisu z punktu widzenia aplikacji. Niektóre deklaracje stają się przestarzałe, czasami dochodzą nowe. Projektując system deklaracji, od początku trzeba było mieć to na uwadze. Oznacza to, że deklaracji nie można było po prostu ,,zaszyć'' w kontrolerze. Dlatego też autor wybrał inne rozwiązanie -- system deklaracji, jako system wtyczek. Każdy rodzaj deklaracji ma swój własny oddzielny komponent. Dzięki temu łatwo w przyszłości będzie dodawać nowe deklaracje, bez naruszenia integralności serwisu. Jest to również powód, dla którego zostały one szerzej opisane.

\subsubsection{Pliki}
\label{subsub:dec-files}
Pliki do systemu deklaracji znajdują się w trzech miejscach:
\begin{itemize}
  \item \emph{components/declarations/} -- tutaj znajdują się klasy deklaracji. Każdy rodzaj deklaracji ma swoją oddzielną klasę. Więcej szczegółów odnośnie klas znajduje się w dalszej części tego rozdziału.
  \item \emph{app/views/deanery/declarations/} -- widoki deklaracji przeznaczone dla studentów. To właśnie one są wyświetlane, w momencie kiedy student wypełnia deklarację. Należy trzymać się konwencji \emph{nazwa deklaracji}$\to$\emph{nazwa widoku}. Jeśli widoków dla jednej deklaracji będzie więcej, informację identyfikującą należy dodawać po twardej spacji.
  \item \emph{app/views/settings/declarations/} -- analogicznie jak powyżej, tyle że widoki przeznaczone są dla prowadzących mających dostęp do ustawień deklaracji.
\end{itemize}

\subsubsection{Klasa główna}
Wszystkie klasy deklaracji powinny dziedziczyć z klasy \emph{Declarations}, która znajduje się w \emph{components/declarations.rb}. Klasa ta, dostarcza klasom potomnym nastęþujące zmienne:
\begin{itemize}
  \item \emph{@logged\_user} -- obiekt zalogowanego użytkownika,
  \item \emph{@declarations\_subjects} -- obiekt modelu \emph{DeclarationsSubject} (tabela \emph{declarations\_subjects}, zob. rozdz.~\ref{subsub:declarations_subjects}, str.~\pageref{subsub:declarations_subjects}) zawierający tylko przedmioty dotyczące deklaracji potomnej,
  \item \emph{@merged\_subjects} -- początkowo pusta. Domyślnie powinna zawierać przedmioty podane w deklaracji przez użytkownika (jeżeli jest to konieczne). Wcześniej należy uruchomić specjalny skrypt, który usuwa wszystkie podejrzane lub błędne wpisy (zabezpieczenie przed fałszerstwem) -- skrypt ten, to \emph{merge\_subjects},
  \item \emph{@flash\_notice} -- wiadomość, jaka ma zostać wyświetlona w czasie wypełniania deklaracji. Domyślnie jest pusta, ale nic nie stoi na przeszkodzie, aby klasa potomna ją ustawiła w razie potrzeby,
  \item \emph{@template} -- nazwa widoku, który ma zostać wyrenderowany. Aplikacja sama dobierze ścieżkę,
  \item \emph{@declaration\_name} -- nazwa deklaracji (pole \emph{head} w tabeli \emph{declarations}, zob. rozdz.~\ref{subsub:declarations}, str.~\pageref{subsub:declarations}),
  \item \emph{@declaration\_id} -- numer \emph{id} deklaracji.
\end{itemize}

\subsubsection{Klasy potomne}
Każda klasa potomna powinna mieć dwie metody -- \emph{execute} oraz \emph{setup}. Obie powinny przyjmować jeden parametr -- będzie to \emph{params} z Ruby~on~Rails. Metoda execute wywołuje się w kontrolerze \emph{DeaneryController}, jest więc przeznaczona dla studentów wypełniających deklaracje. Metoda \emph{setup} wywoła się w kontrolerze \emph{SettingsController}, jest więc przeznaczona dla prowadzących zarządzających deklaracjami. Najważniejsze o czym należy pamiętać w klasach potomnych, to ustawianie zmiennej \emph{@template} z odpowiednim widokiem oraz o tym, aby później inicjalizacje klas potomnych dopisać do metod \emph{declarations} w wyżej wymienionych kontrolerach.

\subsubsection{Struktura bazy danych i relacji}
Wszystkie informacje odnośnie deklaracji po stronie bazy danych zostały opisane w:
\begin{itemize}
  \item Rozdz.~\ref{sub:tabele}, str.~\pageref{subsub:declarations} (Tabela \emph{declarations})
  \item Rozdz.~\ref{sub:tabele}, str.~\pageref{subsub:declarations_subjects} (Tabela \emph{declarations\_subjects})
  \item Rozdz.~\ref{sub:relacje}, str.~\pageref{subsub:declarations-declarations_subjects}
\end{itemize}

Po utworzeniu nowego komponentu należy dopisać odpowiednie deklaracje do tabeli \emph{declarations} oraz ewentualnie utworzyć nowe kolumny w tabeli \emph{declarations\_columns} i wypełnić je danymi początkowymi.

\section{Przemapowanie hiperłączy}
\label{sec:mapa-linkow}
Ostatnim, ważnym problemem jaki należało rozwiązać był problem dotychczasowych odsyłaczy. Nowa aplikacja posiada zupełnie inaczej rozwiązany system odnośników. Nie są to już trzyliterowe, nic nie mówiące skróty, tylko pełne nazwy angielskie. Takie podejście ułatwia pracę robotom wsyszukiwarek, pozycjonuje wyżej stronę, ułatwia ludziom zapamiętanie adresu i przygotowuje możliwość przyszłego tłumaczenia serwisu. Niestety obecnie cała strona EiT jest zaindeksowana pod starymi adresami i uruchomienie nowej aplikacji skutkowałoby ogromną liczbą martwych odsyłaczy. Użytkownik wyszukiwarki po kliknięciu na takie hiperłącze zostałby oddelegowany w próżnię. Aby tego uniknąć stworzony został mapper do linków. Jest to po prostu zestaw regułek w pliku \emph{config/routes.rb}, który tłumaczy stare linki na nowe.

Niestety same wpisy w \emph{routes.rb} nie wystarczą, gdyż wtedy skończylibyśmy z nową treścią renderowaną pod starym adresem URL. Nie jest to zachowanie oczekiwane, gdyż w ten sposób stare odsyłacze nigdy nie zniknęłyby z wyszukiwarek. Dlatego trzeba jeszcze dodać przekierowanie -- czyli zastosować kod HTTP~301 \emph{Moved permanently}. Niestety system rutingu w Ruby~on~Rails nie przewiduje takiego zastosowania, dlatego trzeba posłużyć się pewnym trikiem. Mianowicie, wszystkie zapytania o stare adresy są wpierw kierowane do kontrolera \emph{RedirectController}, a jako parametr podawany jest nowy adres. Kontroler ten, wysyła następnie kod 301 i przekierowuje użytkownika na odpowiednią stronę.

Rozwiązanie takie ma dwie zalety. Po pierwsze, użytkownik klikając w wyszukiwarce na odnośnik, znajduje się już na nowej stronie i od razu widzi w pasku adresu nowy link, dzięki temu nie przywiązuje się do starych oznaczeń. Po drugie, wyszukiwarki dużo szybciej usuwają stare linki i przeindeksowują je sobie na nowe, jeśli napotykają kod \emph{Moved Permamently}.

\section{Testowanie i instalacja}
\label{sec:testowanie}
W ramach niniejszej pracy implementacja projektu została zakończona. Ruby~on~Rails posiada także wbudowaną funkcjonalność pozwalającą na kompleksowe testowanie aplikacji. Zarówno na poziomie jednostkowym, jak i funkcjonalnym. Nie da się ukryć, że tworzenie testów bardzo pomaga w rozwoju aplikacji i chociaż jest bardzo pracochłonne w dłuższej perspektywie pozwala zaoszczędzić czas. Jednak aplikacja opisana w pracy obecnie jest mała, a całość kodu została napisana przez jednego programistę. Dopisanie testów zajęłoby sporo czasu. Autor jest w stanie samodzielnie kompleksowo ją przetestować, dlatego zrezygnował z pisania testów.

Instalacja i uruchomienie ogranicza się do przekopiowania całości kodu na docelowy serwer, który będzie posiadał wszystkie niezbędne komponenty (wymienione w podrozdziale Przygotowanie środowiska pracy, zob. str.~\pageref{sec:srodowisko}). Następnie wystarczy skonfigurować odpowiednie połączenia z bazami w pliku \emph{config/database.yml} (zob. rozdz.~\ref{sub:convert-base}, str.~\pageref{sub:convert-base}), przygotować strukturę w nowej bazie danych (uruchamiając polecenie \emph{rake db:migrate} -- rys.~\ref{fig:runapp}) i przekonwertować starą bazę na nową (polecenie \emph{rake eit:db:convert}).
\begin{figure}[h]
\centering
\begin{verbatim}rake db:migrate
rake eit:db:convert
mongrel_rails start -p 80 -l ./log/mongrel.log -e production)\end{verbatim}
\caption{Kompletny zestaw poleceń, niezbędny do uruchomienia aplikacji\label{fig:runapp}}
\end{figure}

Ostatnim etapem przygotowania jest uruchomienie serwera \emph{mongrel} w trybie produkcyjnym.

%\chapter{Zakończenie}
%\label{cha:end}


\end{document}
